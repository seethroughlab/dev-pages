var ce=Object.defineProperty;var de=(r,t,s)=>t in r?ce(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var C=(r,t,s)=>de(r,typeof t!="symbol"?t+"":t,s);import{r as u,j as e,a as ue,E as me,w as he,R as fe}from"./codemirror-DZYbYuHY.js";import{r as xe,c as ge}from"./react-vendor-Cm8h8Ov8.js";import{A as re}from"./anthropic-DOVQwx1S.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();var $={},J=xe;$.createRoot=J.createRoot,$.hydrateRoot=J.hydrateRoot;const X="shaderlm-conversation",V=r=>{try{const t={messages:r.messages,currentShader:r.currentShader,vertexShader:r.vertexShader,shaderHistory:r.shaderHistory,lastUpdated:Date.now()};localStorage.setItem(X,JSON.stringify(t))}catch(t){console.error("Failed to save conversation to localStorage:",t)}},pe=()=>{try{const r=localStorage.getItem(X);if(!r)return null;const t=JSON.parse(r);return!t.messages||!Array.isArray(t.messages)?null:t}catch(r){return console.error("Failed to load conversation from localStorage:",r),null}},ye=()=>{try{localStorage.removeItem(X)}catch(r){console.error("Failed to clear conversation from localStorage:",r)}};let K=null;async function se(){if(K)return K;if(!navigator.gpu)throw new Error("WebGPU is not supported in this browser");const r=await navigator.gpu.requestAdapter();if(!r)throw new Error("Failed to get GPU adapter");const t=await r.requestDevice();return K=t,t}async function ve(r){try{const n=await(await se()).createShaderModule({code:r,label:"Validation Shader"}).getCompilationInfo(),a=n.messages.filter(c=>c.type==="error"),o=n.messages.filter(c=>c.type==="warning").map(c=>`Line ${c.lineNum}: ${c.message}`);if(a.length>0)return{success:!1,error:a.map(x=>`Line ${x.lineNum}: ${x.message}`).join(`
`),warnings:o.length>0?o:void 0};const i=be(r);return{success:!0,warnings:o.length>0?o:void 0,metadata:i}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown validation error"}}}function be(r){const t=r.match(/@(?:vertex|fragment|compute)\s+fn\s+(\w+)/),s=t?t[1]:"main",a=r.includes("@compute")?"compute":"render",o=/@group\((\d+)\)\s+@binding\((\d+)\)\s+var(?:<([^>]+)>)?\s+(\w+):\s*(\w+)/g,i=[];let c;for(;(c=o.exec(r))!==null;){const[,m,f,g,,N]=c;let w="uniform";g!=null&&g.includes("storage")?w="storage":N.includes("texture")?w="texture":N.includes("sampler")&&(w="sampler"),i.push({group:parseInt(m),binding:parseInt(f),type:w,visibility:"all"})}const x=/@location\((\d+)\)\s+(\w+):\s*([^,\)]+)/g,l=[];for(;(c=x.exec(r))!==null;)l.push({location:parseInt(c[1]),name:c[2],type:c[3].trim()});return{entryPoint:s,bindingLayout:i,usage:a,inputs:l.length>0?l:void 0}}function Q(){return{supported:"gpu"in navigator}}function ne(r){const t=[],s=r.match(/struct\s+Uniforms\s*\{([^}]+)\}/);if(!s)return t;const n=s[1],a=/(\w+):\s*(f32|i32|u32|vec2<f32>|vec3<f32>|vec4<f32>)\s*,?/g;let o;for(;(o=a.exec(n))!==null;){const i=o[1],c=o[2];if(i==="time"||i==="resolution")continue;const x=we(i,c);t.push(x)}return t}function we(r,t){const s=r.toLowerCase();if(t==="f32"||t==="i32"||t==="u32"){let n=1,a=0,o=10,i=.1;return s.includes("count")||s.includes("num")||s.includes("rows")||s.includes("columns")?(n=5,a=1,o=20,i=1):s.includes("speed")?(n=1,a=0,o=5,i=.1):s.includes("scale")?(n=1,a=.1,o=5,i=.1):s.includes("radius")||s.includes("size")?(n=.5,a=0,o=2,i=.05):(s.includes("intensity")||s.includes("strength"))&&(n=1,a=0,o=2,i=.1),{name:r,type:t,defaultValue:n,min:a,max:o,step:i}}return t==="vec2<f32>"?{name:r,type:t,defaultValue:[.5,.5],min:-2,max:2,step:.05}:t==="vec3<f32>"?{name:r,type:t,defaultValue:[1,1,1],min:0,max:1,step:.01}:t==="vec4<f32>"?{name:r,type:t,defaultValue:[1,1,1,1],min:0,max:1,step:.01}:{name:r,type:t,defaultValue:1,min:0,max:10,step:.1}}function je(r){const t=new Map;let s=0;t.set("time",0),s+=4,s=q(s,8),t.set("resolution",s),s+=8;for(const a of r){const{size:o,alignment:i}=Ne(a.type);s=q(s,i),t.set(a.name,s),s+=o}return{size:q(s,16),offsets:t}}function Ne(r){switch(r){case"f32":case"i32":case"u32":return{size:4,alignment:4};case"vec2<f32>":return{size:8,alignment:8};case"vec3<f32>":return{size:12,alignment:16};case"vec4<f32>":return{size:16,alignment:16};default:return{size:4,alignment:4}}}function q(r,t){return Math.ceil(r/t)*t}function Se(r,t,s,n,a){const o=new Float32Array(a.size/4),i=a.offsets.get("time")/4;o[i]=r;const c=a.offsets.get("resolution")/4;o[c]=t[0],o[c+1]=t[1];for(const x of n){const l=a.offsets.get(x.name)/4,m=s[x.name]??x.defaultValue;if(Array.isArray(m))for(let f=0;f<m.length;f++)o[l+f]=m[f];else o[l]=m}return o}class Ce{constructor(){C(this,"device",null);C(this,"context",null);C(this,"pipeline",null);C(this,"uniformBuffer",null);C(this,"bindGroup",null);C(this,"animationId",null);C(this,"startTime",0);C(this,"uniformFields",[]);C(this,"uniformLayout",null);C(this,"customUniformValues",{})}async initialize(t){this.device=await se();const s=t.getContext("webgpu");if(!s)throw new Error("Failed to get WebGPU context");this.context=s;const n=navigator.gpu.getPreferredCanvasFormat();s.configure({device:this.device,format:n,alphaMode:"premultiplied"})}async renderShader(t,s,n){if(!this.device||!this.context)throw new Error("Renderer not initialized");this.cleanup(),this.uniformFields=ne(s),this.uniformLayout=je(this.uniformFields),this.customUniformValues={},this.uniformFields.forEach(x=>{this.customUniformValues[x.name]=x.defaultValue});const a=this.device.createShaderModule({code:t,label:"Vertex Shader"}),o=this.device.createShaderModule({code:s,label:"Fragment Shader"});this.uniformBuffer=this.device.createBuffer({size:this.uniformLayout.size,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const i=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]});this.bindGroup=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const c=this.device.createPipelineLayout({bindGroupLayouts:[i]});this.pipeline=this.device.createRenderPipeline({layout:c,vertex:{module:a,entryPoint:(n==null?void 0:n.entryPoint)||"vs_main"},fragment:{module:o,entryPoint:"fs_main",targets:[{format:navigator.gpu.getPreferredCanvasFormat()}]},primitive:{topology:"triangle-list"}}),this.startTime=Date.now(),this.startAnimation()}startAnimation(){const t=()=>{this.frame(),this.animationId=requestAnimationFrame(t)};t()}updateCustomUniforms(t){this.customUniformValues={...this.customUniformValues,...t}}frame(){if(!this.device||!this.context||!this.pipeline||!this.uniformBuffer||!this.bindGroup||!this.uniformLayout)return;const t=this.context.canvas,s=(Date.now()-this.startTime)/1e3,n=Se(s,[t.width,t.height],this.customUniformValues,this.uniformFields,this.uniformLayout);this.device.queue.writeBuffer(this.uniformBuffer,0,n.buffer,n.byteOffset,n.byteLength);const a=this.device.createCommandEncoder(),o=this.context.getCurrentTexture().createView(),i=a.beginRenderPass({colorAttachments:[{view:o,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]});i.setPipeline(this.pipeline),i.setBindGroup(0,this.bindGroup),i.draw(3),i.end(),this.device.queue.submit([a.finish()])}cleanup(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.uniformBuffer&&(this.uniformBuffer.destroy(),this.uniformBuffer=null),this.pipeline=null,this.bindGroup=null}destroy(){this.cleanup(),this.device=null,this.context=null}}const ke=`
@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> @builtin(position) vec4<f32> {
    // Full-screen triangle
    var pos = array<vec2<f32>, 3>(
        vec2<f32>(-1.0, -1.0),
        vec2<f32>(3.0, -1.0),
        vec2<f32>(-1.0, 3.0)
    );
    return vec4<f32>(pos[vertexIndex], 0.0, 1.0);
}
`,Ee=()=>`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,Z={messages:[],currentShader:"",vertexShader:ke,isGenerating:!1,error:null,shaderHistory:[]},ae=ge(r=>({...Z,addMessage:t=>{const s={...t,id:Ee(),timestamp:Date.now()};r(n=>{const a=[...n.messages,s];return V({messages:a,currentShader:n.currentShader,vertexShader:n.vertexShader,shaderHistory:n.shaderHistory}),{messages:a}})},updateLastMessage:t=>{r(s=>{const n=[...s.messages];return n.length>0&&(n[n.length-1]={...n[n.length-1],content:t}),V({messages:n,currentShader:s.currentShader,vertexShader:s.vertexShader,shaderHistory:s.shaderHistory}),{messages:n}})},setCurrentShader:(t,s)=>{r(n=>{const a=s?[...n.shaderHistory,{code:t,timestamp:Date.now(),messageId:s}]:n.shaderHistory;return V({messages:n.messages,currentShader:t,vertexShader:n.vertexShader,shaderHistory:a}),{currentShader:t,shaderHistory:a}})},setVertexShader:t=>{r(s=>(V({messages:s.messages,currentShader:s.currentShader,vertexShader:t,shaderHistory:s.shaderHistory}),{vertexShader:t}))},setIsGenerating:t=>{r({isGenerating:t})},setError:t=>{r({error:t})},clearConversation:()=>{ye(),r(Z)},loadFromStorage:()=>{const t=pe();t&&r({messages:t.messages,currentShader:t.currentShader,vertexShader:t.vertexShader,shaderHistory:t.shaderHistory})}})),Pe=["A colorful animated gradient","A pulsing circle with glow effect","Wavy water effect","Fractal noise pattern","Rotating rainbow spiral"];function Ae({onSendMessage:r,onOpenApiKeyDialog:t}){const[s,n]=u.useState(""),a=u.useRef(null),o=u.useRef(null),{messages:i,isGenerating:c,clearConversation:x}=ae(),l=()=>{var d;(d=a.current)==null||d.scrollIntoView({behavior:"smooth"})};u.useEffect(()=>{l()},[i]);const m=d=>{d.preventDefault(),s.trim()&&!c&&(r(s.trim()),n(""))},f=d=>{d.key==="Enter"&&(d.ctrlKey||d.metaKey)&&(d.preventDefault(),m(d))},g=d=>{var v;c||(n(d),(v=o.current)==null||v.focus())},N=d=>{navigator.clipboard.writeText(d)},w=d=>new Date(d).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),y=()=>{window.confirm("Are you sure you want to clear the conversation? This cannot be undone.")&&x()};return e.jsxs("div",{className:"flex flex-col h-full bg-gray-800 border-r border-gray-700",children:[e.jsxs("div",{className:"flex-shrink-0 p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"Shader Chat"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:t,className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors",title:"Edit API Key",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),i.length>0&&e.jsx("button",{onClick:y,className:"text-xs px-2 py-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors",title:"Clear conversation",children:"Clear"})]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"Describe shaders and refine them iteratively"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[i.length===0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center text-gray-400 py-8",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto mb-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("p",{className:"text-sm mb-2",children:"Start a conversation to generate a shader"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Try one of these examples:"})]}),e.jsx("div",{className:"space-y-2",children:Pe.map((d,v)=>e.jsx("button",{onClick:()=>g(d),disabled:c,className:"w-full text-left px-4 py-3 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-800 disabled:cursor-not-allowed rounded-lg transition-colors text-sm",children:d},v))})]}):e.jsxs(e.Fragment,{children:[i.map(d=>{var v;return e.jsx("div",{className:`flex ${d.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-lg px-4 py-2 ${d.role==="user"?"bg-blue-600 text-white":d.role==="system"?"bg-red-900 text-red-100":"bg-gray-700 text-gray-100"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1 whitespace-pre-wrap break-words text-sm",children:d.content}),d.role==="assistant"&&e.jsx("button",{onClick:()=>N(d.content),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",title:"Copy message",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),e.jsx("div",{className:"text-xs mt-1 opacity-70",children:w(d.timestamp)}),((v=d.metadata)==null?void 0:v.validationError)&&e.jsx("div",{className:"mt-2 p-2 bg-red-900/50 rounded text-xs font-mono",children:d.metadata.validationError})]})},d.id)}),c&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-700 text-gray-100 rounded-lg px-4 py-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-sm text-gray-400",children:"Generating..."})]})})})]}),e.jsx("div",{ref:a})]}),e.jsx("div",{className:"flex-shrink-0 p-4 border-t border-gray-700",children:e.jsxs("form",{onSubmit:m,className:"space-y-2",children:[e.jsx("textarea",{ref:o,value:s,onChange:d=>n(d.target.value),onKeyDown:f,placeholder:i.length===0?"Describe the shader you want to create...":"Describe how to refine the shader...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-white placeholder-gray-400 text-sm",rows:3,disabled:c}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500",children:"Ctrl+Enter to send"}),e.jsx("button",{type:"submit",disabled:!s.trim()||c,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-medium transition-colors text-sm",children:c?"Generating...":"Send"})]})]})})]})}function Le({shader:r,onChange:t,readOnly:s}){return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"bg-gray-800 px-4 py-2 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-sm font-semibold",children:"Fragment Shader (WGSL)"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(r)},className:"text-xs px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded transition-colors",disabled:!r,children:"Copy"})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(ue,{value:r,height:"100%",theme:"dark",extensions:[me.lineWrapping,he()],onChange:t,readOnly:s,basicSetup:{lineNumbers:!0,highlightActiveLineGutter:!0,highlightActiveLine:!0,foldGutter:!0,dropCursor:!0,indentOnInput:!0,syntaxHighlighting:!0,bracketMatching:!0,autocompletion:!0},placeholder:"Your generated shader will appear here...",className:"code-editor"})})]})}function Ie({shader:r,vertexShader:t,customUniforms:s}){const n=u.useRef(null),a=u.useRef(null),o=u.useRef(null),[i,c]=u.useState(null),[x,l]=u.useState(!1),[m,f]=u.useState(!1),[g,N]=u.useState(!1);u.useEffect(()=>{const y=n.current;return y?((async()=>{try{o.current||(o.current=new Ce,await o.current.initialize(y),f(!0))}catch(v){c(v instanceof Error?v.message:"Failed to initialize WebGPU")}})(),()=>{o.current&&(o.current.destroy(),o.current=null),f(!1)}):void 0},[]),u.useEffect(()=>{if(!r||!o.current||!m)return;(async()=>{c(null),l(!0);try{await o.current.renderShader(t,r)}catch(d){c(d instanceof Error?d.message:"Failed to render shader")}finally{l(!1)}})()},[r,t,m]),u.useEffect(()=>{s&&o.current&&m&&o.current.updateCustomUniforms(s)},[s,m]),u.useEffect(()=>{const y=n.current;if(!y)return;const d=new ResizeObserver(v=>{for(const A of v){const{width:E,height:k}=A.contentRect;y.width=E*devicePixelRatio,y.height=k*devicePixelRatio}});return d.observe(y),()=>{d.disconnect()}},[]),u.useEffect(()=>{const y=()=>{N(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",y),()=>{document.removeEventListener("fullscreenchange",y)}},[]);const w=async()=>{const y=a.current;if(y)try{document.fullscreenElement?await document.exitFullscreen():await y.requestFullscreen()}catch(d){console.error("Error toggling fullscreen:",d)}};return e.jsxs("div",{ref:a,className:"relative w-full h-full",children:[e.jsx("canvas",{ref:n,className:"w-full h-full",style:{imageRendering:"pixelated"}}),e.jsx("button",{onClick:w,className:"absolute top-4 left-4 bg-gray-800/80 hover:bg-gray-700/90 text-white p-2 rounded transition-colors backdrop-blur-sm",title:g?"Exit Fullscreen":"Enter Fullscreen",children:g?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),!r&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsx("p",{className:"text-gray-400",children:"Generate a shader to see preview"})}),x&&e.jsx("div",{className:"absolute top-4 right-4 bg-blue-600 text-white text-xs px-3 py-1 rounded-full",children:"Rendering..."}),i&&e.jsxs("div",{className:"absolute bottom-4 left-4 right-4 bg-red-900/90 border border-red-500 text-red-200 text-sm p-3 rounded",children:[e.jsx("strong",{children:"Render Error:"})," ",i]})]})}function Me({shader:r,onValuesChange:t}){const[s,n]=u.useState([]),[a,o]=u.useState({});u.useEffect(()=>{const l=ne(r);n(l);const m={};l.forEach(f=>{m[f.name]=f.defaultValue}),o(m),l.length>0&&t(m)},[r,t]);const i=(l,m)=>{const f={...a,[l]:m};o(f),t(f)},c=(l,m)=>{const f=parseFloat(m);isNaN(f)||i(l,f)},x=(l,m,f)=>{const g=parseFloat(f);if(!isNaN(g)){const w=[...a[l]];w[m]=g,i(l,w)}};return s.length===0?null:e.jsxs("div",{className:"p-4 bg-gray-800 border-b border-gray-700",children:[e.jsx("h3",{className:"text-sm font-semibold mb-3 text-gray-200",children:"Shader Uniforms"}),e.jsx("div",{className:"space-y-3 max-h-48 overflow-y-auto",children:s.map(l=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-300 capitalize",children:l.name.replace(/([A-Z])/g," $1").trim()}),(l.type==="f32"||l.type==="i32"||l.type==="u32")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:l.min,max:l.max,step:l.step,value:a[l.name],onChange:m=>c(l.name,m.target.value),className:"flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"}),e.jsx("input",{type:"number",min:l.min,max:l.max,step:l.step,value:a[l.name],onChange:m=>c(l.name,m.target.value),className:"w-16 px-2 py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),l.type==="vec2<f32>"&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["x","y"].map((m,f)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:m}),e.jsx("input",{type:"number",min:l.min,max:l.max,step:l.step,value:a[l.name][f],onChange:g=>x(l.name,f,g.target.value),className:"w-full px-2 py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]},m))}),l.type==="vec3<f32>"&&e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["x","y","z"].map((m,f)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:m}),e.jsx("input",{type:"number",min:l.min,max:l.max,step:l.step,value:a[l.name][f],onChange:g=>x(l.name,f,g.target.value),className:"w-full px-2 py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]},m))}),l.type==="vec4<f32>"&&e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["x","y","z","w"].map((m,f)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:m}),e.jsx("input",{type:"number",min:l.min,max:l.max,step:l.step,value:a[l.name][f],onChange:g=>x(l.name,f,g.target.value),className:"w-full px-2 py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]},m))})]},l.name))})]})}const Fe="ShaderLM",Re=1,S="projects";let O=null;async function U(){return O||new Promise((r,t)=>{const s=indexedDB.open(Fe,Re);s.onerror=()=>{t(new Error("Failed to open IndexedDB"))},s.onsuccess=()=>{O=s.result,r(O)},s.onupgradeneeded=n=>{const a=n.target.result;if(!a.objectStoreNames.contains(S)){const o=a.createObjectStore(S,{keyPath:"id",autoIncrement:!0});o.createIndex("name","name",{unique:!1}),o.createIndex("createdAt","createdAt",{unique:!1}),o.createIndex("updatedAt","updatedAt",{unique:!1})}}})}async function ee(r){const t=await U();return new Promise((s,n)=>{const o=t.transaction([S],"readwrite").objectStore(S),i={...r,updatedAt:Date.now()},c=o.add(i);c.onsuccess=()=>{s(c.result)},c.onerror=()=>{n(new Error("Failed to save project"))}})}async function De(r){if(!r.id)throw new Error("Project ID is required for update");const t=await U();return new Promise((s,n)=>{const o=t.transaction([S],"readwrite").objectStore(S),i={...r,updatedAt:Date.now()},c=o.put(i);c.onsuccess=()=>{s()},c.onerror=()=>{n(new Error("Failed to update project"))}})}async function Ue(r){const t=await U();return new Promise((s,n)=>{const i=t.transaction([S],"readonly").objectStore(S).get(r);i.onsuccess=()=>{s(i.result||null)},i.onerror=()=>{n(new Error("Failed to load project"))}})}async function Ge(){const r=await U();return new Promise((t,s)=>{const o=r.transaction([S],"readonly").objectStore(S).getAll();o.onsuccess=()=>{const i=o.result||[];i.sort((c,x)=>x.updatedAt-c.updatedAt),t(i)},o.onerror=()=>{s(new Error("Failed to load projects"))}})}async function ze(r){const t=await U();return new Promise((s,n)=>{const i=t.transaction([S],"readwrite").objectStore(S).delete(r);i.onsuccess=()=>{s()},i.onerror=()=>{n(new Error("Failed to delete project"))}})}function Ve(r){return JSON.stringify(r,null,2)}function Oe(r){const t=JSON.parse(r),{id:s,...n}=t;if(!t.name||!t.shader||!t.messages)throw new Error("Invalid project format");return{...n,createdAt:Date.now(),updatedAt:Date.now()}}function We({isOpen:r,onClose:t,currentShader:s,currentVertexShader:n,currentMessages:a,currentUniforms:o,onLoadProject:i,currentProjectId:c}){const[x,l]=u.useState([]),[m,f]=u.useState(!1),[g,N]=u.useState(!1),[w,y]=u.useState(!1),[d,v]=u.useState(""),[A,E]=u.useState(""),[k,F]=u.useState("");u.useEffect(()=>{r&&P()},[r]);const P=async()=>{f(!0);try{const h=await Ge();l(h)}catch(h){console.error("Failed to load projects:",h)}finally{f(!1)}},W=async()=>{if(!d.trim()){alert("Please enter a project name");return}N(!0);try{const h={name:d.trim(),description:A.trim()||void 0,shader:s,vertexShader:n,messages:a,customUniforms:o,createdAt:Date.now(),updatedAt:Date.now()};c?await De({...h,id:c}):await ee(h),y(!1),v(""),E(""),await P()}catch(h){console.error("Failed to save project:",h),alert("Failed to save project")}finally{N(!1)}},R=async h=>{try{const j=await Ue(h);j&&(i(j),t())}catch(j){console.error("Failed to load project:",j),alert("Failed to load project")}},T=async h=>{if(window.confirm("Are you sure you want to delete this project?"))try{await ze(h),await P()}catch(j){console.error("Failed to delete project:",j),alert("Failed to delete project")}},B=h=>{const j=Ve(h),D=new Blob([j],{type:"application/json"}),p=URL.createObjectURL(D),b=document.createElement("a");b.href=p,b.download=`${h.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.json`,b.click(),URL.revokeObjectURL(p)},_=()=>{const h=document.createElement("input");h.type="file",h.accept=".json",h.onchange=async j=>{var p;const D=(p=j.target.files)==null?void 0:p[0];if(D)try{const b=await D.text(),L=Oe(b);await ee(L),await P()}catch(b){console.error("Failed to import project:",b),alert("Failed to import project. Please check the file format.")}},h.click()},G=k?x.filter(h=>{var j;return h.name.toLowerCase().includes(k.toLowerCase())||((j=h.description)==null?void 0:j.toLowerCase().includes(k.toLowerCase()))}):x;return r?e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-700",children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Project Manager"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-4 border-b border-gray-700 space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(!0),disabled:!s,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded font-medium transition-colors",children:"Save Current Project"}),e.jsx("button",{onClick:_,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded font-medium transition-colors",children:"Import"})]}),e.jsx("input",{type:"text",placeholder:"Search projects...",value:k,onChange:h=>F(h.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:m?e.jsx("div",{className:"text-center text-gray-400 py-8",children:"Loading projects..."}):G.length===0?e.jsx("div",{className:"text-center text-gray-400 py-8",children:k?"No projects found":"No saved projects yet"}):e.jsx("div",{className:"space-y-3",children:G.map(h=>e.jsx("div",{className:"bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-white",children:h.name}),h.description&&e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:h.description}),e.jsxs("div",{className:"flex gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{children:["Created: ",new Date(h.createdAt).toLocaleDateString()]}),e.jsxs("span",{children:["Updated: ",new Date(h.updatedAt).toLocaleDateString()]}),e.jsxs("span",{children:[h.messages.length," messages"]})]})]}),e.jsxs("div",{className:"flex gap-2 ml-4",children:[e.jsx("button",{onClick:()=>R(h.id),className:"px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition-colors",children:"Load"}),e.jsx("button",{onClick:()=>B(h),className:"px-3 py-1 bg-gray-800 hover:bg-gray-900 rounded text-sm transition-colors",title:"Export as JSON",children:"Export"}),e.jsx("button",{onClick:()=>T(h.id),className:"px-3 py-1 bg-red-600 hover:bg-red-700 rounded text-sm transition-colors",children:"Delete"})]})]})},h.id))})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"Save Project"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Project Name *"}),e.jsx("input",{type:"text",value:d,onChange:h=>v(h.target.value),placeholder:"My Awesome Shader",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-1",children:"Description (optional)"}),e.jsx("textarea",{value:A,onChange:h=>E(h.target.value),placeholder:"A beautiful animated gradient shader...",rows:3,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400 resize-none"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{y(!1),v(""),E("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded font-medium transition-colors",children:"Cancel"}),e.jsx("button",{onClick:W,disabled:!d.trim()||g,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded font-medium transition-colors",children:g?"Saving...":"Save"})]})]})]})})]}):null}function te({onResize:r}){const t=u.useRef(!1),s=u.useRef(0);u.useEffect(()=>{const a=i=>{if(!t.current)return;const c=i.clientX-s.current;s.current=i.clientX,r(c)},o=()=>{t.current=!1,document.body.style.cursor="",document.body.style.userSelect=""};return document.addEventListener("mousemove",a),document.addEventListener("mouseup",o),()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",o)}},[r]);const n=a=>{t.current=!0,s.current=a.clientX,document.body.style.cursor="col-resize",document.body.style.userSelect="none",a.preventDefault()};return e.jsx("div",{onMouseDown:n,className:"w-1 bg-gray-700 hover:bg-blue-500 cursor-col-resize transition-colors flex-shrink-0 group relative",children:e.jsx("div",{className:"absolute inset-y-0 -left-1 -right-1"})})}const Te=`You are an expert WebGPU shader developer specializing in WGSL (WebGPU Shading Language).

Key WGSL Rules:
- WGSL has STRICT typing with NO implicit conversions
- All functions must have explicit return types
- Entry points must use @vertex, @fragment, or @compute attributes
- Bindings use @group(N) @binding(M) decorations
- Built-in values use @builtin() attribute
- Workgroup size for compute: @workgroup_size(X, Y, Z)

Common WGSL Functions:
- Math: sin, cos, tan, sqrt, pow, abs, floor, ceil, round, clamp, mix, smoothstep
- Vector: dot, cross, length, normalize, distance, reflect
- Texture: textureSample, textureLoad, textureDimensions
- No function overloading - functions must have unique names

Type Syntax:
- Scalars: f32, i32, u32, bool
- Vectors: vec2<f32>, vec3<f32>, vec4<f32>
- Matrices: mat2x2<f32>, mat3x3<f32>, mat4x4<f32>
- Arrays: array<f32, 10> or array<f32>

IMPORTANT: Always use f32 literals with decimal point (e.g., 1.0, not 1)`,Be=`
Example 1: Simple Triangle Vertex + Fragment Shader
\`\`\`wgsl
@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> @builtin(position) vec4<f32> {
    var pos = array<vec2<f32>, 3>(
        vec2<f32>(0.0, 0.5),
        vec2<f32>(-0.5, -0.5),
        vec2<f32>(0.5, -0.5)
    );
    return vec4<f32>(pos[vertexIndex], 0.0, 1.0);
}

@fragment
fn fs_main() -> @location(0) vec4<f32> {
    return vec4<f32>(1.0, 0.0, 0.0, 1.0); // Red
}
\`\`\`

Example 2: Shader with Uniforms
\`\`\`wgsl
struct Uniforms {
    time: f32,
    resolution: vec2<f32>,
}

@group(0) @binding(0) var<uniform> uniforms: Uniforms;

@fragment
fn fs_main(@builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {
    let uv = fragCoord.xy / uniforms.resolution;
    let col = 0.5 + 0.5 * cos(uniforms.time + uv.xyx + vec3<f32>(0.0, 2.0, 4.0));
    return vec4<f32>(col, 1.0);
}
\`\`\`

Example 3: Compute Shader
\`\`\`wgsl
@group(0) @binding(0) var<storage, read_write> data: array<f32>;

@compute @workgroup_size(256)
fn cs_main(@builtin(global_invocation_id) global_id: vec3<u32>) {
    let index = global_id.x;
    data[index] = data[index] * 2.0;
}
\`\`\``;function _e(){return`${Te}

${Be}

You are helping users create and iteratively refine WebGPU shaders through conversation.

When users request a shader:
1. Generate complete WGSL shader code in a \`\`\`wgsl code block
2. Provide a brief explanation of how it works
3. Include any JavaScript setup code needed (in a \`\`\`javascript block)

When users request refinements or modifications:
1. Understand what they want to change
2. Modify the existing shader accordingly
3. Provide the complete updated shader code
4. Explain what you changed and why

If a shader has validation errors:
- The user will share the error message with you
- Fix the issue and provide the corrected shader
- Explain what was wrong and how you fixed it

Available uniforms (automatically provided):
- time: f32 - current time in seconds
- resolution: vec2<f32> - canvas resolution (width, height)

You can add custom uniforms to the Uniforms struct for user-controllable parameters:
- The UI will automatically detect and create sliders for custom uniform fields
- Good examples: rows, columns, speed, scale, radius, intensity, etc.
- Users can adjust these values in real-time via the UI

Default context:
- A full-screen triangle vertex shader is provided automatically
- You typically only need to write fragment shaders
- Fragment shaders receive @builtin(position) fragCoord which is screen coordinates

Remember:
- Use explicit f32 types (1.0 not 1)
- No implicit type conversions
- Always provide complete, working shader code
- Be conversational and helpful in your explanations`}const oe="shaderlm_api_key",He=365;function Ke(r,t,s){const n=new Date;n.setTime(n.getTime()+s*24*60*60*1e3);const a=`expires=${n.toUTCString()}`;document.cookie=`${r}=${t};${a};path=/;SameSite=Strict`}function qe(r){const t=`${r}=`,s=document.cookie.split(";");for(let n of s){let a=n.trim();if(a.indexOf(t)===0)return a.substring(t.length)}return null}function Y(){return qe(oe)}function $e(r){Ke(oe,r,He)}let ie;function le(r){const t=r||Y();if(!t)throw new Error("No API key available. Please set your Claude API key.");ie=new re({apiKey:t,dangerouslyAllowBrowser:!0})}function Ye(r){le(r)}async function Xe(r){try{return await new re({apiKey:r,dangerouslyAllowBrowser:!0}).messages.create({model:"claude-sonnet-4-20250514",max_tokens:10,messages:[{role:"user",content:"Hi"}]}),{valid:!0}}catch(t){return console.error("API key validation failed:",t),t instanceof Error?{valid:!1,error:t.message}:{valid:!1,error:"Unknown error occurred"}}}try{le()}catch{console.warn("Claude client not initialized - API key required")}async function*Je(r,t){try{const s=await ie.messages.create({model:"claude-sonnet-4-20250514",max_tokens:4e3,system:r,messages:t,stream:!0});for await(const n of s)n.type==="content_block_delta"&&n.delta.type==="text_delta"&&(yield n.delta.text)}catch(s){throw console.error("Error in conversational shader generation:",s),new Error(`Failed to generate shader: ${s instanceof Error?s.message:"Unknown error"}`)}}function Qe({isOpen:r,onClose:t,allowCancel:s=!1}){const[n,a]=u.useState(""),[o,i]=u.useState(!1),[c,x]=u.useState(null),l=async()=>{if(!n.trim()){x("Please enter an API key");return}i(!0),x(null);try{const g=await Xe(n.trim());g.valid?($e(n.trim()),Ye(n.trim()),a(""),t()):x(g.error||"Invalid API key. Please check and try again.")}catch(g){x("Failed to validate API key. Please try again."),console.error("API key validation error:",g)}finally{i(!1)}},m=()=>{s&&(a(""),x(null),t())},f=g=>{g.key==="Enter"&&!o&&l()};return r?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-white mb-2",children:"Enter Claude API Key"}),e.jsxs("p",{className:"text-gray-400 text-sm",children:["Your API key will be stored securely in your browser cookies. Get your key from"," ",e.jsx("a",{href:"https://console.anthropic.com/settings/keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"Anthropic Console"}),"."]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"apiKey",className:"block text-sm font-medium text-gray-300 mb-2",children:"API Key"}),e.jsx("input",{id:"apiKey",type:"password",value:n,onChange:g=>a(g.target.value),onKeyPress:f,placeholder:"sk-ant-...",disabled:o,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"})]}),c&&e.jsx("div",{className:"mb-4 p-3 bg-red-900/50 border border-red-700 rounded-md",children:e.jsx("p",{className:"text-red-200 text-sm",children:c})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[s&&e.jsx("button",{onClick:m,disabled:o,className:"px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Cancel"}),e.jsx("button",{onClick:l,disabled:o||!n.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Validating..."})]}):"Save"})]})]})}):null}async function Ze(r){const t=r.match(/```wgsl\n([\s\S]*?)```/),s=t?t[1].trim():"",n=r.replace(/```[\s\S]*?```/g,"").trim();if(!s)return{shader:"",isValid:!1,error:"No shader code found in response",explanation:n};const a=await ve(s);return{shader:s,isValid:a.success,error:a.error,explanation:n}}function et(){const{currentShader:r,vertexShader:t,isGenerating:s,messages:n,setCurrentShader:a,setVertexShader:o,setIsGenerating:i,setError:c,addMessage:x,updateLastMessage:l,loadFromStorage:m,clearConversation:f}=ae(),[g,N]=u.useState({}),[w,y]=u.useState(!1),[d,v]=u.useState(),[A,E]=u.useState(),[k,F]=u.useState(!1),[P,W]=u.useState(()=>{const p=localStorage.getItem("chatWidth");return p?parseInt(p,10):384}),[R,T]=u.useState(()=>{const p=localStorage.getItem("editorWidth");return p?parseInt(p,10):500});u.useEffect(()=>{Y()||F(!0)},[]),u.useEffect(()=>{m()},[m]),u.useEffect(()=>{localStorage.setItem("chatWidth",P.toString())},[P]),u.useEffect(()=>{localStorage.setItem("editorWidth",R.toString())},[R]),u.useEffect(()=>{Q().supported||c("WebGPU is not supported in your browser")},[c]);const B=u.useCallback(p=>{f(),a(p.shader),p.vertexShader&&o(p.vertexShader),p.messages.forEach(b=>{x({role:b.role,content:b.content,metadata:b.metadata})}),p.customUniforms&&N(p.customUniforms),v(p.id),E(p.name)},[f,a,o,x]),_=()=>{r&&!window.confirm("Starting a new project will clear the current conversation. Are you sure?")||(f(),v(void 0),E(void 0),N({}))},G=p=>{W(b=>Math.max(250,Math.min(800,b+p)))},h=p=>{T(b=>Math.max(300,Math.min(1e3,b+p)))},j=async p=>{var b;x({role:"user",content:p}),i(!0),c(null);try{const L=[...n.filter(M=>M.role!=="system").map(M=>({role:M.role,content:M.content})),{role:"user",content:p}],z=_e();x({role:"assistant",content:""});let H="";for await(const M of Je(z,L))H+=M,l(H);const I=await Ze(H);I.shader&&(a(I.shader,(b=n[n.length-1])==null?void 0:b.id),!I.isValid&&I.error&&x({role:"system",content:`Validation Error: ${I.error}`,metadata:{validationError:I.error}}))}catch(L){const z=L instanceof Error?L.message:"Unknown error";c(z),x({role:"system",content:`Error: ${z}`})}finally{i(!1)}};if(!Q().supported){const p=window.location.protocol==="http:"&&!window.location.hostname.match(/^(localhost|127\.0\.0\.1)$/);return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-900",children:e.jsxs("div",{className:"text-center p-8 bg-red-900/20 border border-red-500 rounded-lg max-w-md",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-400 mb-4",children:"WebGPU Not Supported"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Your browser doesn't support WebGPU."}),p?e.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-600 rounded p-4 mb-4",children:[e.jsx("p",{className:"text-yellow-200 text-sm mb-2",children:e.jsx("strong",{children:"⚠️ Insecure Context Detected"})}),e.jsx("p",{className:"text-yellow-100 text-sm",children:"WebGPU requires HTTPS or localhost. You're accessing this page via HTTP."})]}):null,e.jsxs("div",{className:"text-left text-sm text-gray-400 space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"Requirements:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Chrome 113+ or Edge 113+"}),e.jsx("li",{children:"HTTPS connection or localhost"})]})]})]})})}return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-900 text-white",children:[e.jsx("header",{className:"bg-gray-800 border-b border-gray-700 p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"WebGPU Shader Generator"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["AI-powered iterative WGSL shader creation",A&&e.jsxs("span",{className:"ml-2 text-blue-400",children:["• ",A]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:_,className:"px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm font-medium transition-colors",title:"New Project",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-sm font-medium transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})}),"Projects"]})]})]})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{style:{width:`${P}px`},className:"flex-shrink-0 flex flex-col",children:e.jsx(Ae,{onSendMessage:j,onOpenApiKeyDialog:()=>F(!0)})}),e.jsx(te,{onResize:G}),e.jsx("div",{style:{width:`${R}px`},className:"flex-shrink-0 flex flex-col",children:e.jsx(Le,{shader:r,onChange:a,readOnly:s})}),e.jsx(te,{onResize:h}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Me,{shader:r,onValuesChange:N}),e.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-black rounded-lg overflow-hidden",children:e.jsx(Ie,{shader:r,vertexShader:t,customUniforms:g})})})]})]}),e.jsx("footer",{className:"bg-gray-800 border-t border-gray-700 p-2 text-center text-xs text-gray-400",children:"Powered by Claude & WebGPU | Chat to iteratively refine your shader"}),e.jsx(We,{isOpen:w,onClose:()=>y(!1),currentShader:r,currentVertexShader:t,currentMessages:n,currentUniforms:g,onLoadProject:B,currentProjectId:d}),e.jsx(Qe,{isOpen:k,onClose:()=>F(!1),allowCancel:Y()!==null})]})}$.createRoot(document.getElementById("root")).render(e.jsx(fe.StrictMode,{children:e.jsx(et,{})}));
