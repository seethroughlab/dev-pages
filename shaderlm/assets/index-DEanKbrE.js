var xe=Object.defineProperty;var ge=(r,t,s)=>t in r?xe(r,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[t]=s;var S=(r,t,s)=>ge(r,typeof t!="symbol"?t+"":t,s);import{r as m,j as e,a as pe,E as ye,w as ve,R as be}from"./codemirror-DZYbYuHY.js";import{r as we,c as je}from"./react-vendor-Cm8h8Ov8.js";import{A as le}from"./anthropic-DOVQwx1S.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();var Q={},te=we;Q.createRoot=te.createRoot,Q.hydrateRoot=te.hydrateRoot;const ee="shaderlm-conversation",W=r=>{try{const t={messages:r.messages,currentShader:r.currentShader,vertexShader:r.vertexShader,shaderHistory:r.shaderHistory,lastUpdated:Date.now()};localStorage.setItem(ee,JSON.stringify(t))}catch(t){console.error("Failed to save conversation to localStorage:",t)}},Ne=()=>{try{const r=localStorage.getItem(ee);if(!r)return null;const t=JSON.parse(r);return!t.messages||!Array.isArray(t.messages)?null:t}catch(r){return console.error("Failed to load conversation from localStorage:",r),null}},Se=()=>{try{localStorage.removeItem(ee)}catch(r){console.error("Failed to clear conversation from localStorage:",r)}};let q=null;async function ce(){if(q)return q;if(!navigator.gpu)throw new Error("WebGPU is not supported in this browser");const r=await navigator.gpu.requestAdapter();if(!r)throw new Error("Failed to get GPU adapter");const t=await r.requestDevice();return q=t,t}async function ke(r){try{const n=await(await ce()).createShaderModule({code:r,label:"Validation Shader"}).getCompilationInfo(),o=n.messages.filter(c=>c.type==="error"),a=n.messages.filter(c=>c.type==="warning").map(c=>`Line ${c.lineNum}: ${c.message}`);if(o.length>0)return{success:!1,error:o.map(h=>`Line ${h.lineNum}: ${h.message}`).join(`
`),warnings:a.length>0?a:void 0};const l=Ce(r);return{success:!0,warnings:a.length>0?a:void 0,metadata:l}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown validation error"}}}function Ce(r){const t=r.match(/@(?:vertex|fragment|compute)\s+fn\s+(\w+)/),s=t?t[1]:"main",o=r.includes("@compute")?"compute":"render",a=/@group\((\d+)\)\s+@binding\((\d+)\)\s+var(?:<([^>]+)>)?\s+(\w+):\s*(\w+)/g,l=[];let c;for(;(c=a.exec(r))!==null;){const[,d,x,g,,b]=c;let w="uniform";g!=null&&g.includes("storage")?w="storage":b.includes("texture")?w="texture":b.includes("sampler")&&(w="sampler"),l.push({group:parseInt(d),binding:parseInt(x),type:w,visibility:"all"})}const h=/@location\((\d+)\)\s+(\w+):\s*([^,\)]+)/g,i=[];for(;(c=h.exec(r))!==null;)i.push({location:parseInt(c[1]),name:c[2],type:c[3].trim()});return{entryPoint:s,bindingLayout:l,usage:o,inputs:i.length>0?i:void 0}}function re(){return{supported:"gpu"in navigator}}function de(r){const t=[],s=r.match(/struct\s+Uniforms\s*\{([^}]+)\}/);if(!s)return t;const n=s[1],o=/(\w+):\s*(f32|i32|u32|vec2<f32>|vec3<f32>|vec4<f32>)\s*,?/g;let a;for(;(a=o.exec(n))!==null;){const l=a[1],c=a[2];if(l==="time"||l==="resolution")continue;const h=Ee(l,c);t.push(h)}return t}function Ee(r,t){const s=r.toLowerCase();if(t==="f32"||t==="i32"||t==="u32"){let n=1,o=0,a=10,l=.1;return s.includes("count")||s.includes("num")||s.includes("rows")||s.includes("columns")?(n=5,o=1,a=20,l=1):s.includes("speed")?(n=1,o=0,a=5,l=.1):s.includes("scale")?(n=1,o=.1,a=5,l=.1):s.includes("radius")||s.includes("size")?(n=.5,o=0,a=2,l=.05):(s.includes("intensity")||s.includes("strength"))&&(n=1,o=0,a=2,l=.1),{name:r,type:t,defaultValue:n,min:o,max:a,step:l}}return t==="vec2<f32>"?{name:r,type:t,defaultValue:[.5,.5],min:-2,max:2,step:.05}:t==="vec3<f32>"?{name:r,type:t,defaultValue:[1,1,1],min:0,max:1,step:.01}:t==="vec4<f32>"?{name:r,type:t,defaultValue:[1,1,1,1],min:0,max:1,step:.01}:{name:r,type:t,defaultValue:1,min:0,max:10,step:.1}}function Pe(r){const t=new Map;let s=0;t.set("time",0),s+=4,s=Y(s,8),t.set("resolution",s),s+=8;for(const o of r){const{size:a,alignment:l}=Le(o.type);s=Y(s,l),t.set(o.name,s),s+=a}return{size:Y(s,16),offsets:t}}function Le(r){switch(r){case"f32":case"i32":case"u32":return{size:4,alignment:4};case"vec2<f32>":return{size:8,alignment:8};case"vec3<f32>":return{size:12,alignment:16};case"vec4<f32>":return{size:16,alignment:16};default:return{size:4,alignment:4}}}function Y(r,t){return Math.ceil(r/t)*t}function Ae(r,t,s,n,o){const a=new Float32Array(o.size/4),l=o.offsets.get("time")/4;a[l]=r;const c=o.offsets.get("resolution")/4;a[c]=t[0],a[c+1]=t[1];for(const h of n){const i=o.offsets.get(h.name)/4,d=s[h.name]??h.defaultValue;if(Array.isArray(d))for(let x=0;x<d.length;x++)a[i+x]=d[x];else a[i]=d}return a}class Me{constructor(){S(this,"device",null);S(this,"context",null);S(this,"pipeline",null);S(this,"uniformBuffer",null);S(this,"bindGroup",null);S(this,"animationId",null);S(this,"startTime",0);S(this,"uniformFields",[]);S(this,"uniformLayout",null);S(this,"customUniformValues",{})}async initialize(t){this.device=await ce();const s=t.getContext("webgpu");if(!s)throw new Error("Failed to get WebGPU context");this.context=s;const n=navigator.gpu.getPreferredCanvasFormat();s.configure({device:this.device,format:n,alphaMode:"premultiplied"})}async renderShader(t,s,n){if(!this.device||!this.context)throw new Error("Renderer not initialized");this.cleanup(),this.uniformFields=de(s),this.uniformLayout=Pe(this.uniformFields),this.customUniformValues={},this.uniformFields.forEach(h=>{this.customUniformValues[h.name]=h.defaultValue});const o=this.device.createShaderModule({code:t,label:"Vertex Shader"}),a=this.device.createShaderModule({code:s,label:"Fragment Shader"});this.uniformBuffer=this.device.createBuffer({size:this.uniformLayout.size,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const l=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]});this.bindGroup=this.device.createBindGroup({layout:l,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const c=this.device.createPipelineLayout({bindGroupLayouts:[l]});this.pipeline=this.device.createRenderPipeline({layout:c,vertex:{module:o,entryPoint:(n==null?void 0:n.entryPoint)||"vs_main"},fragment:{module:a,entryPoint:"fs_main",targets:[{format:navigator.gpu.getPreferredCanvasFormat()}]},primitive:{topology:"triangle-list"}}),this.startTime=Date.now(),this.startAnimation()}startAnimation(){const t=()=>{this.frame(),this.animationId=requestAnimationFrame(t)};t()}updateCustomUniforms(t){this.customUniformValues={...this.customUniformValues,...t}}frame(){if(!this.device||!this.context||!this.pipeline||!this.uniformBuffer||!this.bindGroup||!this.uniformLayout)return;const t=this.context.canvas,s=(Date.now()-this.startTime)/1e3,n=Ae(s,[t.width,t.height],this.customUniformValues,this.uniformFields,this.uniformLayout);this.device.queue.writeBuffer(this.uniformBuffer,0,n.buffer,n.byteOffset,n.byteLength);const o=this.device.createCommandEncoder(),a=this.context.getCurrentTexture().createView(),l=o.beginRenderPass({colorAttachments:[{view:a,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]});l.setPipeline(this.pipeline),l.setBindGroup(0,this.bindGroup),l.draw(3),l.end(),this.device.queue.submit([o.finish()])}cleanup(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.uniformBuffer&&(this.uniformBuffer.destroy(),this.uniformBuffer=null),this.pipeline=null,this.bindGroup=null}destroy(){this.cleanup(),this.device=null,this.context=null}}const Ie=`
@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> @builtin(position) vec4<f32> {
    // Full-screen triangle
    var pos = array<vec2<f32>, 3>(
        vec2<f32>(-1.0, -1.0),
        vec2<f32>(3.0, -1.0),
        vec2<f32>(-1.0, 3.0)
    );
    return vec4<f32>(pos[vertexIndex], 0.0, 1.0);
}
`,Fe=()=>`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,se={messages:[],currentShader:"",vertexShader:Ie,isGenerating:!1,error:null,shaderHistory:[]},ue=je(r=>({...se,addMessage:t=>{const s={...t,id:Fe(),timestamp:Date.now()};r(n=>{const o=[...n.messages,s];return W({messages:o,currentShader:n.currentShader,vertexShader:n.vertexShader,shaderHistory:n.shaderHistory}),{messages:o}})},updateLastMessage:t=>{r(s=>{const n=[...s.messages];return n.length>0&&(n[n.length-1]={...n[n.length-1],content:t}),W({messages:n,currentShader:s.currentShader,vertexShader:s.vertexShader,shaderHistory:s.shaderHistory}),{messages:n}})},setCurrentShader:(t,s)=>{r(n=>{const o=s?[...n.shaderHistory,{code:t,timestamp:Date.now(),messageId:s}]:n.shaderHistory;return W({messages:n.messages,currentShader:t,vertexShader:n.vertexShader,shaderHistory:o}),{currentShader:t,shaderHistory:o}})},setVertexShader:t=>{r(s=>(W({messages:s.messages,currentShader:s.currentShader,vertexShader:t,shaderHistory:s.shaderHistory}),{vertexShader:t}))},setIsGenerating:t=>{r({isGenerating:t})},setError:t=>{r({error:t})},clearConversation:()=>{Se(),r(se)},loadFromStorage:()=>{const t=Ne();t&&r({messages:t.messages,currentShader:t.currentShader,vertexShader:t.vertexShader,shaderHistory:t.shaderHistory})}})),De=["A colorful animated gradient","A pulsing circle with glow effect","Wavy water effect","Fractal noise pattern","Rotating rainbow spiral"];function ne({onSendMessage:r,onOpenApiKeyDialog:t}){const[s,n]=m.useState(""),o=m.useRef(null),a=m.useRef(null),{messages:l,isGenerating:c,clearConversation:h}=ue(),i=()=>{var u;(u=o.current)==null||u.scrollIntoView({behavior:"smooth"})};m.useEffect(()=>{i()},[l]);const d=u=>{u.preventDefault(),s.trim()&&!c&&(r(s.trim()),n(""))},x=u=>{u.key==="Enter"&&(u.ctrlKey||u.metaKey)&&(u.preventDefault(),d(u))},g=u=>{var v;c||(n(u),(v=a.current)==null||v.focus())},b=u=>{navigator.clipboard.writeText(u)},w=u=>new Date(u).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),y=()=>{window.confirm("Are you sure you want to clear the conversation? This cannot be undone.")&&h()};return e.jsxs("div",{className:"flex flex-col h-full bg-gray-800 md:border-r border-gray-700",children:[e.jsxs("div",{className:"flex-shrink-0 p-3 md:p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base md:text-lg font-semibold text-white",children:"Shader Chat"}),e.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[e.jsx("button",{onClick:t,className:"p-2 md:p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors touch-manipulation",title:"Edit API Key",children:e.jsx("svg",{className:"w-5 h-5 md:w-4 md:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),l.length>0&&e.jsx("button",{onClick:y,className:"text-xs md:text-xs px-3 py-2 md:px-2 md:py-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors touch-manipulation",title:"Clear conversation",children:"Clear"})]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 hidden sm:block",children:"Describe shaders and refine them iteratively"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 md:p-4 space-y-3 md:space-y-4",children:[l.length===0?e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"text-center text-gray-400 py-4 md:py-8",children:[e.jsx("svg",{className:"w-12 h-12 md:w-16 md:h-16 mx-auto mb-3 md:mb-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("p",{className:"text-sm mb-2",children:"Start a conversation to generate a shader"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Try one of these examples:"})]}),e.jsx("div",{className:"space-y-2",children:De.map((u,v)=>e.jsx("button",{onClick:()=>g(u),disabled:c,className:"w-full text-left px-4 py-3 bg-gray-700 hover:bg-gray-600 active:bg-gray-600 disabled:bg-gray-800 disabled:cursor-not-allowed rounded-lg transition-colors text-sm touch-manipulation",children:u},v))})]}):e.jsxs(e.Fragment,{children:[l.map(u=>{var v;return e.jsx("div",{className:`flex ${u.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-lg px-4 py-2 ${u.role==="user"?"bg-blue-600 text-white":u.role==="system"?"bg-red-900 text-red-100":"bg-gray-700 text-gray-100"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1 whitespace-pre-wrap break-words text-sm",children:u.content}),u.role==="assistant"&&e.jsx("button",{onClick:()=>b(u.content),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",title:"Copy message",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),e.jsx("div",{className:"text-xs mt-1 opacity-70",children:w(u.timestamp)}),((v=u.metadata)==null?void 0:v.validationError)&&e.jsx("div",{className:"mt-2 p-2 bg-red-900/50 rounded text-xs font-mono",children:u.metadata.validationError})]})},u.id)}),c&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-700 text-gray-100 rounded-lg px-4 py-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-sm text-gray-400",children:"Generating..."})]})})})]}),e.jsx("div",{ref:o})]}),e.jsx("div",{className:"flex-shrink-0 p-3 md:p-4 border-t border-gray-700",children:e.jsxs("form",{onSubmit:d,className:"space-y-2",children:[e.jsx("textarea",{ref:a,value:s,onChange:u=>n(u.target.value),onKeyDown:x,placeholder:l.length===0?"Describe the shader you want to create...":"Describe how to refine the shader...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-white placeholder-gray-400 text-sm md:text-sm",rows:3,disabled:c}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500 hidden sm:block",children:"Ctrl+Enter to send"}),e.jsx("button",{type:"submit",disabled:!s.trim()||c,className:"px-4 py-2 md:py-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-medium transition-colors text-sm touch-manipulation ml-auto",children:c?"Generating...":"Send"})]})]})})]})}function ae({shader:r,onChange:t,readOnly:s}){return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"bg-gray-800 px-3 md:px-4 py-2 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-sm font-semibold truncate",children:"Fragment Shader (WGSL)"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(r)},className:"text-xs px-3 py-2 md:py-1 bg-gray-700 hover:bg-gray-600 active:bg-gray-600 rounded transition-colors touch-manipulation ml-2",disabled:!r,children:"Copy"})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(pe,{value:r,height:"100%",theme:"dark",extensions:[ye.lineWrapping,ve()],onChange:t,readOnly:s,basicSetup:{lineNumbers:!0,highlightActiveLineGutter:!0,highlightActiveLine:!0,foldGutter:!0,dropCursor:!0,indentOnInput:!0,syntaxHighlighting:!0,bracketMatching:!0,autocompletion:!0},placeholder:"Your generated shader will appear here...",className:"code-editor"})})]})}function X({shader:r,vertexShader:t,customUniforms:s}){const n=m.useRef(null),o=m.useRef(null),a=m.useRef(null),[l,c]=m.useState(null),[h,i]=m.useState(!1),[d,x]=m.useState(!1),[g,b]=m.useState(!1);m.useEffect(()=>{const y=n.current;return y?((async()=>{try{a.current||(a.current=new Me,await a.current.initialize(y),x(!0))}catch(v){c(v instanceof Error?v.message:"Failed to initialize WebGPU")}})(),()=>{a.current&&(a.current.destroy(),a.current=null),x(!1)}):void 0},[]),m.useEffect(()=>{if(!r||!a.current||!d)return;(async()=>{c(null),i(!0);try{await a.current.renderShader(t,r)}catch(u){c(u instanceof Error?u.message:"Failed to render shader")}finally{i(!1)}})()},[r,t,d]),m.useEffect(()=>{s&&a.current&&d&&a.current.updateCustomUniforms(s)},[s,d]),m.useEffect(()=>{const y=n.current;if(!y)return;const u=new ResizeObserver(v=>{for(const M of v){const{width:E,height:C}=M.contentRect;y.width=E*devicePixelRatio,y.height=C*devicePixelRatio}});return u.observe(y),()=>{u.disconnect()}},[]),m.useEffect(()=>{const y=()=>{b(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",y),()=>{document.removeEventListener("fullscreenchange",y)}},[]);const w=async()=>{const y=o.current;if(y)try{document.fullscreenElement?await document.exitFullscreen():await y.requestFullscreen()}catch(u){console.error("Error toggling fullscreen:",u)}};return e.jsxs("div",{ref:o,className:"relative w-full h-full",children:[e.jsx("canvas",{ref:n,className:"w-full h-full",style:{imageRendering:"pixelated"}}),e.jsx("button",{onClick:w,className:"absolute top-2 md:top-4 left-2 md:left-4 bg-gray-800/80 hover:bg-gray-700/90 active:bg-gray-700/90 text-white p-2 md:p-2 rounded transition-colors backdrop-blur-sm touch-manipulation",title:g?"Exit Fullscreen":"Enter Fullscreen",children:g?e.jsx("svg",{className:"w-5 h-5 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):e.jsx("svg",{className:"w-5 h-5 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),!r&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 px-4",children:e.jsx("p",{className:"text-gray-400 text-sm md:text-base text-center",children:"Generate a shader to see preview"})}),h&&e.jsx("div",{className:"absolute top-2 md:top-4 right-2 md:right-4 bg-blue-600 text-white text-xs px-3 py-1 rounded-full",children:"Rendering..."}),l&&e.jsxs("div",{className:"absolute bottom-2 md:bottom-4 left-2 md:left-4 right-2 md:right-4 bg-red-900/90 border border-red-500 text-red-200 text-xs md:text-sm p-2 md:p-3 rounded",children:[e.jsx("strong",{children:"Render Error:"})," ",l]})]})}function J({shader:r,onValuesChange:t}){const[s,n]=m.useState([]),[o,a]=m.useState({});m.useEffect(()=>{const i=de(r);n(i);const d={};i.forEach(x=>{d[x.name]=x.defaultValue}),a(d),i.length>0&&t(d)},[r,t]);const l=(i,d)=>{const x={...o,[i]:d};a(x),t(x)},c=(i,d)=>{const x=parseFloat(d);isNaN(x)||l(i,x)},h=(i,d,x)=>{const g=parseFloat(x);if(!isNaN(g)){const w=[...o[i]];w[d]=g,l(i,w)}};return s.length===0?null:e.jsxs("div",{className:"p-2 md:p-4 bg-gray-800 border-b border-gray-700",children:[e.jsx("h3",{className:"text-xs md:text-sm font-semibold mb-2 md:mb-3 text-gray-200",children:"Shader Uniforms"}),e.jsx("div",{className:"space-y-2 md:space-y-3 max-h-40 md:max-h-48 overflow-y-auto",children:s.map(i=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-300 capitalize",children:i.name.replace(/([A-Z])/g," $1").trim()}),(i.type==="f32"||i.type==="i32"||i.type==="u32")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:i.min,max:i.max,step:i.step,value:o[i.name],onChange:d=>c(i.name,d.target.value),className:"flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500 touch-manipulation"}),e.jsx("input",{type:"number",min:i.min,max:i.max,step:i.step,value:o[i.name],onChange:d=>c(i.name,d.target.value),className:"w-14 md:w-16 px-2 py-1.5 md:py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),i.type==="vec2<f32>"&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["x","y"].map((d,x)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:d}),e.jsx("input",{type:"number",min:i.min,max:i.max,step:i.step,value:o[i.name][x],onChange:g=>h(i.name,x,g.target.value),className:"w-full px-2 py-1.5 md:py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]},d))}),i.type==="vec3<f32>"&&e.jsx("div",{className:"grid grid-cols-3 gap-1.5 md:gap-2",children:["x","y","z"].map((d,x)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:d}),e.jsx("input",{type:"number",min:i.min,max:i.max,step:i.step,value:o[i.name][x],onChange:g=>h(i.name,x,g.target.value),className:"w-full px-1.5 md:px-2 py-1.5 md:py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]},d))}),i.type==="vec4<f32>"&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-1.5 md:gap-2",children:["x","y","z","w"].map((d,x)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:d}),e.jsx("input",{type:"number",min:i.min,max:i.max,step:i.step,value:o[i.name][x],onChange:g=>h(i.name,x,g.target.value),className:"w-full px-1.5 md:px-2 py-1.5 md:py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]},d))})]},i.name))})]})}const Re="ShaderLM",Ue=1,N="projects";let B=null;async function G(){return B||new Promise((r,t)=>{const s=indexedDB.open(Re,Ue);s.onerror=()=>{t(new Error("Failed to open IndexedDB"))},s.onsuccess=()=>{B=s.result,r(B)},s.onupgradeneeded=n=>{const o=n.target.result;if(!o.objectStoreNames.contains(N)){const a=o.createObjectStore(N,{keyPath:"id",autoIncrement:!0});a.createIndex("name","name",{unique:!1}),a.createIndex("createdAt","createdAt",{unique:!1}),a.createIndex("updatedAt","updatedAt",{unique:!1})}}})}async function oe(r){const t=await G();return new Promise((s,n)=>{const a=t.transaction([N],"readwrite").objectStore(N),l={...r,updatedAt:Date.now()},c=a.add(l);c.onsuccess=()=>{s(c.result)},c.onerror=()=>{n(new Error("Failed to save project"))}})}async function Ve(r){if(!r.id)throw new Error("Project ID is required for update");const t=await G();return new Promise((s,n)=>{const a=t.transaction([N],"readwrite").objectStore(N),l={...r,updatedAt:Date.now()},c=a.put(l);c.onsuccess=()=>{s()},c.onerror=()=>{n(new Error("Failed to update project"))}})}async function Ge(r){const t=await G();return new Promise((s,n)=>{const l=t.transaction([N],"readonly").objectStore(N).get(r);l.onsuccess=()=>{s(l.result||null)},l.onerror=()=>{n(new Error("Failed to load project"))}})}async function ze(){const r=await G();return new Promise((t,s)=>{const a=r.transaction([N],"readonly").objectStore(N).getAll();a.onsuccess=()=>{const l=a.result||[];l.sort((c,h)=>h.updatedAt-c.updatedAt),t(l)},a.onerror=()=>{s(new Error("Failed to load projects"))}})}async function Oe(r){const t=await G();return new Promise((s,n)=>{const l=t.transaction([N],"readwrite").objectStore(N).delete(r);l.onsuccess=()=>{s()},l.onerror=()=>{n(new Error("Failed to delete project"))}})}function Te(r){return JSON.stringify(r,null,2)}function We(r){const t=JSON.parse(r),{id:s,...n}=t;if(!t.name||!t.shader||!t.messages)throw new Error("Invalid project format");return{...n,createdAt:Date.now(),updatedAt:Date.now()}}function Be({isOpen:r,onClose:t,currentShader:s,currentVertexShader:n,currentMessages:o,currentUniforms:a,onLoadProject:l,currentProjectId:c}){const[h,i]=m.useState([]),[d,x]=m.useState(!1),[g,b]=m.useState(!1),[w,y]=m.useState(!1),[u,v]=m.useState(""),[M,E]=m.useState(""),[C,I]=m.useState("");m.useEffect(()=>{r&&P()},[r]);const P=async()=>{x(!0);try{const f=await ze();i(f)}catch(f){console.error("Failed to load projects:",f)}finally{x(!1)}},_=async()=>{if(!u.trim()){alert("Please enter a project name");return}b(!0);try{const f={name:u.trim(),description:M.trim()||void 0,shader:s,vertexShader:n,messages:o,customUniforms:a,createdAt:Date.now(),updatedAt:Date.now()};c?await Ve({...f,id:c}):await oe(f),y(!1),v(""),E(""),await P()}catch(f){console.error("Failed to save project:",f),alert("Failed to save project")}finally{b(!1)}},U=async f=>{try{const j=await Ge(f);j&&(l(j),t())}catch(j){console.error("Failed to load project:",j),alert("Failed to load project")}},H=async f=>{if(window.confirm("Are you sure you want to delete this project?"))try{await Oe(f),await P()}catch(j){console.error("Failed to delete project:",j),alert("Failed to delete project")}},V=f=>{const j=Te(f),F=new Blob([j],{type:"application/json"}),L=URL.createObjectURL(F),A=document.createElement("a");A.href=L,A.download=`${f.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.json`,A.click(),URL.revokeObjectURL(L)},K=()=>{const f=document.createElement("input");f.type="file",f.accept=".json",f.onchange=async j=>{var L;const F=(L=j.target.files)==null?void 0:L[0];if(F)try{const A=await F.text(),p=We(A);await oe(p),await P()}catch(A){console.error("Failed to import project:",A),alert("Failed to import project. Please check the file format.")}},f.click()},z=C?h.filter(f=>{var j;return f.name.toLowerCase().includes(C.toLowerCase())||((j=f.description)==null?void 0:j.toLowerCase().includes(C.toLowerCase()))}):h;return r?e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-0 md:p-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-none md:rounded-lg shadow-xl max-w-4xl w-full h-full md:max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-white",children:"Project Manager"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors p-2 touch-manipulation",children:e.jsx("svg",{className:"w-5 h-5 md:w-6 md:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-3 md:p-4 border-b border-gray-700 space-y-2 md:space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>y(!0),disabled:!s,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded font-medium transition-colors text-sm touch-manipulation",children:"Save Current Project"}),e.jsx("button",{onClick:K,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 active:bg-gray-600 rounded font-medium transition-colors text-sm touch-manipulation",children:"Import"})]}),e.jsx("input",{type:"text",placeholder:"Search projects...",value:C,onChange:f=>I(f.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400 text-sm"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 md:p-4",children:d?e.jsx("div",{className:"text-center text-gray-400 py-8 text-sm md:text-base",children:"Loading projects..."}):z.length===0?e.jsx("div",{className:"text-center text-gray-400 py-8 text-sm md:text-base",children:C?"No projects found":"No saved projects yet"}):e.jsx("div",{className:"space-y-2 md:space-y-3",children:z.map(f=>e.jsx("div",{className:"bg-gray-700 rounded-lg p-3 md:p-4 hover:bg-gray-600 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-white text-sm md:text-base truncate",children:f.name}),f.description&&e.jsx("p",{className:"text-xs md:text-sm text-gray-400 mt-1 line-clamp-2",children:f.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"whitespace-nowrap",children:["Created: ",new Date(f.createdAt).toLocaleDateString()]}),e.jsxs("span",{className:"whitespace-nowrap",children:["Updated: ",new Date(f.updatedAt).toLocaleDateString()]}),e.jsxs("span",{className:"whitespace-nowrap",children:[f.messages.length," messages"]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:ml-4 flex-wrap sm:flex-nowrap",children:[e.jsx("button",{onClick:()=>U(f.id),className:"flex-1 sm:flex-none px-3 py-2 md:py-1 bg-blue-600 hover:bg-blue-700 active:bg-blue-700 rounded text-sm transition-colors touch-manipulation",children:"Load"}),e.jsx("button",{onClick:()=>V(f),className:"flex-1 sm:flex-none px-3 py-2 md:py-1 bg-gray-800 hover:bg-gray-900 active:bg-gray-900 rounded text-sm transition-colors touch-manipulation",title:"Export as JSON",children:"Export"}),e.jsx("button",{onClick:()=>H(f.id),className:"flex-1 sm:flex-none px-3 py-2 md:py-1 bg-red-600 hover:bg-red-700 active:bg-red-700 rounded text-sm transition-colors touch-manipulation",children:"Delete"})]})]})},f.id))})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-4 md:p-6",children:[e.jsx("h3",{className:"text-base md:text-lg font-bold text-white mb-3 md:mb-4",children:"Save Project"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs md:text-sm font-medium text-gray-300 mb-1",children:"Project Name *"}),e.jsx("input",{type:"text",value:u,onChange:f=>v(f.target.value),placeholder:"My Awesome Shader",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400 text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs md:text-sm font-medium text-gray-300 mb-1",children:"Description (optional)"}),e.jsx("textarea",{value:M,onChange:f=>E(f.target.value),placeholder:"A beautiful animated gradient shader...",rows:3,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400 resize-none text-sm"})]}),e.jsxs("div",{className:"flex gap-2 justify-end flex-col-reverse sm:flex-row",children:[e.jsx("button",{onClick:()=>{y(!1),v(""),E("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 active:bg-gray-600 rounded font-medium transition-colors text-sm touch-manipulation",children:"Cancel"}),e.jsx("button",{onClick:_,disabled:!u.trim()||g,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded font-medium transition-colors text-sm touch-manipulation",children:g?"Saving...":"Save"})]})]})]})})]}):null}function ie({onResize:r}){const t=m.useRef(!1),s=m.useRef(0);m.useEffect(()=>{const a=i=>{if(!t.current)return;const d=i.clientX-s.current;s.current=i.clientX,r(d)},l=()=>{t.current=!1,document.body.style.cursor="",document.body.style.userSelect=""},c=i=>{if(!t.current||!i.touches[0])return;const d=i.touches[0].clientX-s.current;s.current=i.touches[0].clientX,r(d),i.preventDefault()},h=()=>{t.current=!1,document.body.style.userSelect=""};return document.addEventListener("mousemove",a),document.addEventListener("mouseup",l),document.addEventListener("touchmove",c,{passive:!1}),document.addEventListener("touchend",h),()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",h)}},[r]);const n=a=>{t.current=!0,s.current=a.clientX,document.body.style.cursor="col-resize",document.body.style.userSelect="none",a.preventDefault()},o=a=>{a.touches[0]&&(t.current=!0,s.current=a.touches[0].clientX,document.body.style.userSelect="none",a.preventDefault())};return e.jsx("div",{onMouseDown:n,onTouchStart:o,className:"w-1 md:w-2 bg-gray-700 hover:bg-blue-500 active:bg-blue-600 cursor-col-resize transition-colors flex-shrink-0 group relative touch-none",children:e.jsx("div",{className:"absolute inset-y-0 -left-2 -right-2 md:-left-4 md:-right-4"})})}const _e=`You are an expert WebGPU shader developer specializing in WGSL (WebGPU Shading Language).

Key WGSL Rules:
- WGSL has STRICT typing with NO implicit conversions
- All functions must have explicit return types
- Entry points must use @vertex, @fragment, or @compute attributes
- Bindings use @group(N) @binding(M) decorations
- Built-in values use @builtin() attribute
- Workgroup size for compute: @workgroup_size(X, Y, Z)

Common WGSL Functions:
- Math: sin, cos, tan, sqrt, pow, abs, floor, ceil, round, clamp, mix, smoothstep
- Vector: dot, cross, length, normalize, distance, reflect
- Texture: textureSample, textureLoad, textureDimensions
- No function overloading - functions must have unique names

Type Syntax:
- Scalars: f32, i32, u32, bool
- Vectors: vec2<f32>, vec3<f32>, vec4<f32>
- Matrices: mat2x2<f32>, mat3x3<f32>, mat4x4<f32>
- Arrays: array<f32, 10> or array<f32>

IMPORTANT: Always use f32 literals with decimal point (e.g., 1.0, not 1)`,He=`
Example 1: Simple Triangle Vertex + Fragment Shader
\`\`\`wgsl
@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> @builtin(position) vec4<f32> {
    var pos = array<vec2<f32>, 3>(
        vec2<f32>(0.0, 0.5),
        vec2<f32>(-0.5, -0.5),
        vec2<f32>(0.5, -0.5)
    );
    return vec4<f32>(pos[vertexIndex], 0.0, 1.0);
}

@fragment
fn fs_main() -> @location(0) vec4<f32> {
    return vec4<f32>(1.0, 0.0, 0.0, 1.0); // Red
}
\`\`\`

Example 2: Shader with Uniforms
\`\`\`wgsl
struct Uniforms {
    time: f32,
    resolution: vec2<f32>,
}

@group(0) @binding(0) var<uniform> uniforms: Uniforms;

@fragment
fn fs_main(@builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {
    let uv = fragCoord.xy / uniforms.resolution;
    let col = 0.5 + 0.5 * cos(uniforms.time + uv.xyx + vec3<f32>(0.0, 2.0, 4.0));
    return vec4<f32>(col, 1.0);
}
\`\`\`

Example 3: Compute Shader
\`\`\`wgsl
@group(0) @binding(0) var<storage, read_write> data: array<f32>;

@compute @workgroup_size(256)
fn cs_main(@builtin(global_invocation_id) global_id: vec3<u32>) {
    let index = global_id.x;
    data[index] = data[index] * 2.0;
}
\`\`\``;function Ke(){return`${_e}

${He}

You are helping users create and iteratively refine WebGPU shaders through conversation.

When users request a shader:
1. Generate complete WGSL shader code in a \`\`\`wgsl code block
2. Provide a brief explanation of how it works
3. Include any JavaScript setup code needed (in a \`\`\`javascript block)

When users request refinements or modifications:
1. Understand what they want to change
2. Modify the existing shader accordingly
3. Provide the complete updated shader code
4. Explain what you changed and why

If a shader has validation errors:
- The user will share the error message with you
- Fix the issue and provide the corrected shader
- Explain what was wrong and how you fixed it

Available uniforms (automatically provided):
- time: f32 - current time in seconds
- resolution: vec2<f32> - canvas resolution (width, height)

You can add custom uniforms to the Uniforms struct for user-controllable parameters:
- The UI will automatically detect and create sliders for custom uniform fields
- Good examples: rows, columns, speed, scale, radius, intensity, etc.
- Users can adjust these values in real-time via the UI

Default context:
- A full-screen triangle vertex shader is provided automatically
- You typically only need to write fragment shaders
- Fragment shaders receive @builtin(position) fragCoord which is screen coordinates

Remember:
- Use explicit f32 types (1.0 not 1)
- No implicit type conversions
- Always provide complete, working shader code
- Be conversational and helpful in your explanations`}const me="shaderlm_api_key",$e=365;function qe(r,t,s){const n=new Date;n.setTime(n.getTime()+s*24*60*60*1e3);const o=`expires=${n.toUTCString()}`;document.cookie=`${r}=${t};${o};path=/;SameSite=Strict`}function Ye(r){const t=`${r}=`,s=document.cookie.split(";");for(let n of s){let o=n.trim();if(o.indexOf(t)===0)return o.substring(t.length)}return null}function Z(){return Ye(me)}function Xe(r){qe(me,r,$e)}let he;function fe(r){const t=r||Z();if(!t)throw new Error("No API key available. Please set your Claude API key.");he=new le({apiKey:t,dangerouslyAllowBrowser:!0})}function Je(r){fe(r)}async function Qe(r){try{return await new le({apiKey:r,dangerouslyAllowBrowser:!0}).messages.create({model:"claude-sonnet-4-20250514",max_tokens:10,messages:[{role:"user",content:"Hi"}]}),{valid:!0}}catch(t){return console.error("API key validation failed:",t),t instanceof Error?{valid:!1,error:t.message}:{valid:!1,error:"Unknown error occurred"}}}try{fe()}catch{console.warn("Claude client not initialized - API key required")}async function*Ze(r,t){try{const s=await he.messages.create({model:"claude-sonnet-4-20250514",max_tokens:4e3,system:r,messages:t,stream:!0});for await(const n of s)n.type==="content_block_delta"&&n.delta.type==="text_delta"&&(yield n.delta.text)}catch(s){throw console.error("Error in conversational shader generation:",s),new Error(`Failed to generate shader: ${s instanceof Error?s.message:"Unknown error"}`)}}function et({isOpen:r,onClose:t,allowCancel:s=!1}){const[n,o]=m.useState(""),[a,l]=m.useState(!1),[c,h]=m.useState(null),i=async()=>{if(!n.trim()){h("Please enter an API key");return}l(!0),h(null);try{const g=await Qe(n.trim());g.valid?(Xe(n.trim()),Je(n.trim()),o(""),t()):h(g.error||"Invalid API key. Please check and try again.")}catch(g){h("Failed to validate API key. Please try again."),console.error("API key validation error:",g)}finally{l(!1)}},d=()=>{s&&(o(""),h(null),t())},x=g=>{g.key==="Enter"&&!a&&i()};return r?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-4 md:p-6",children:[e.jsxs("div",{className:"mb-3 md:mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-white mb-2",children:"Enter Claude API Key"}),e.jsxs("p",{className:"text-gray-400 text-xs md:text-sm",children:["Your API key will be stored securely in your browser cookies. Get your key from"," ",e.jsx("a",{href:"https://console.anthropic.com/settings/keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"Anthropic Console"}),"."]})]}),e.jsxs("div",{className:"mb-3 md:mb-4",children:[e.jsx("label",{htmlFor:"apiKey",className:"block text-xs md:text-sm font-medium text-gray-300 mb-2",children:"API Key"}),e.jsx("input",{id:"apiKey",type:"password",value:n,onChange:g=>o(g.target.value),onKeyPress:x,placeholder:"sk-ant-...",disabled:a,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"})]}),c&&e.jsx("div",{className:"mb-3 md:mb-4 p-2 md:p-3 bg-red-900/50 border border-red-700 rounded-md",children:e.jsx("p",{className:"text-red-200 text-xs md:text-sm",children:c})}),e.jsxs("div",{className:"flex justify-end gap-2 flex-col-reverse sm:flex-row",children:[s&&e.jsx("button",{onClick:d,disabled:a,className:"px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 active:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm touch-manipulation",children:"Cancel"}),e.jsx("button",{onClick:i,disabled:a||!n.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 active:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 text-sm touch-manipulation",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Validating..."})]}):"Save"})]})]})}):null}const tt=({activeTab:r,onTabChange:t})=>e.jsxs("div",{className:"flex border-b border-gray-700 bg-gray-800",children:[e.jsx("button",{onClick:()=>t("chat"),className:`flex-1 py-3 px-4 text-sm font-medium transition-colors ${r==="chat"?"bg-gray-700 text-white border-b-2 border-blue-500":"text-gray-400 hover:text-gray-200 hover:bg-gray-750"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("span",{children:"Chat"})]})}),e.jsx("button",{onClick:()=>t("editor"),className:`flex-1 py-3 px-4 text-sm font-medium transition-colors ${r==="editor"?"bg-gray-700 text-white border-b-2 border-blue-500":"text-gray-400 hover:text-gray-200 hover:bg-gray-750"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})}),e.jsx("span",{children:"Editor"})]})})]});async function rt(r){const t=r.match(/```wgsl\n([\s\S]*?)```/),s=t?t[1].trim():"",n=r.replace(/```[\s\S]*?```/g,"").trim();if(!s)return{shader:"",isValid:!1,error:"No shader code found in response",explanation:n};const o=await ke(s);return{shader:s,isValid:o.success,error:o.error,explanation:n}}function st(){const{currentShader:r,vertexShader:t,isGenerating:s,messages:n,setCurrentShader:o,setVertexShader:a,setIsGenerating:l,setError:c,addMessage:h,updateLastMessage:i,loadFromStorage:d,clearConversation:x}=ue(),[g,b]=m.useState({}),[w,y]=m.useState(!1),[u,v]=m.useState(),[M,E]=m.useState(),[C,I]=m.useState(!1),[P,_]=m.useState("chat"),[U,H]=m.useState(()=>{const p=localStorage.getItem("chatWidth");return p?parseInt(p,10):384}),[V,K]=m.useState(()=>{const p=localStorage.getItem("editorWidth");return p?parseInt(p,10):500});m.useEffect(()=>{Z()||I(!0)},[]),m.useEffect(()=>{d()},[d]),m.useEffect(()=>{localStorage.setItem("chatWidth",U.toString())},[U]),m.useEffect(()=>{localStorage.setItem("editorWidth",V.toString())},[V]),m.useEffect(()=>{re().supported||c("WebGPU is not supported in your browser")},[c]);const z=m.useCallback(p=>{x(),o(p.shader),p.vertexShader&&a(p.vertexShader),p.messages.forEach(k=>{h({role:k.role,content:k.content,metadata:k.metadata})}),p.customUniforms&&b(p.customUniforms),v(p.id),E(p.name)},[x,o,a,h]),f=()=>{r&&!window.confirm("Starting a new project will clear the current conversation. Are you sure?")||(x(),v(void 0),E(void 0),b({}))},j=p=>{H(k=>Math.max(250,Math.min(800,k+p)))},F=p=>{K(k=>Math.max(300,Math.min(1e3,k+p)))},L=async p=>{var k;h({role:"user",content:p}),l(!0),c(null);try{const O=[...n.filter(R=>R.role!=="system").map(R=>({role:R.role,content:R.content})),{role:"user",content:p}],T=Ke();h({role:"assistant",content:""});let $="";for await(const R of Ze(T,O))$+=R,i($);const D=await rt($);D.shader&&(o(D.shader,(k=n[n.length-1])==null?void 0:k.id),!D.isValid&&D.error&&h({role:"system",content:`Validation Error: ${D.error}`,metadata:{validationError:D.error}}))}catch(O){const T=O instanceof Error?O.message:"Unknown error";c(T),h({role:"system",content:`Error: ${T}`})}finally{l(!1)}};if(!re().supported){const p=window.location.protocol==="http:"&&!window.location.hostname.match(/^(localhost|127\.0\.0\.1)$/);return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-900",children:e.jsxs("div",{className:"text-center p-8 bg-red-900/20 border border-red-500 rounded-lg max-w-md",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-400 mb-4",children:"WebGPU Not Supported"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Your browser doesn't support WebGPU."}),p?e.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-600 rounded p-4 mb-4",children:[e.jsx("p",{className:"text-yellow-200 text-sm mb-2",children:e.jsx("strong",{children:"⚠️ Insecure Context Detected"})}),e.jsx("p",{className:"text-yellow-100 text-sm",children:"WebGPU requires HTTPS or localhost. You're accessing this page via HTTP."})]}):null,e.jsxs("div",{className:"text-left text-sm text-gray-400 space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"Requirements:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Chrome 113+ or Edge 113+"}),e.jsx("li",{children:"HTTPS connection or localhost"})]})]})]})})}return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-900 text-white",children:[e.jsx("header",{className:"bg-gray-800 border-b border-gray-700 p-2 md:p-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg md:text-2xl font-bold truncate",children:"WebGPU Shader Generator"}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-400 truncate",children:[e.jsx("span",{className:"hidden sm:inline",children:"AI-powered iterative WGSL shader creation"}),e.jsx("span",{className:"sm:hidden",children:"AI shader generation"}),M&&e.jsxs("span",{className:"ml-2 text-blue-400",children:["• ",M]})]})]}),e.jsxs("div",{className:"flex gap-1 md:gap-2 ml-2",children:[e.jsx("button",{onClick:f,className:"px-2 md:px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm font-medium transition-colors",title:"New Project",children:e.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("button",{onClick:()=>y(!0),className:"px-2 md:px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-sm font-medium transition-colors flex items-center gap-1 md:gap-2",children:[e.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"Projects"})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"md:hidden flex-1 flex flex-col overflow-hidden",children:[e.jsx(J,{shader:r,onValuesChange:b}),e.jsx("div",{className:"flex-1 p-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-black rounded-lg overflow-hidden",children:e.jsx(X,{shader:r,vertexShader:t,customUniforms:g})})})]}),e.jsxs("div",{className:"md:flex-1 lg:hidden flex flex-col overflow-hidden",children:[e.jsx(tt,{activeTab:P,onTabChange:_}),P==="chat"&&e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx(ne,{onSendMessage:L,onOpenApiKeyDialog:()=>I(!0)})}),P==="editor"&&e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx(ae,{shader:r,onChange:o,readOnly:s})})]}),e.jsxs("div",{className:"hidden md:flex lg:hidden flex-1 flex-col overflow-hidden",children:[e.jsx(J,{shader:r,onValuesChange:b}),e.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-black rounded-lg overflow-hidden",children:e.jsx(X,{shader:r,vertexShader:t,customUniforms:g})})})]}),e.jsx("div",{style:{width:`${U}px`},className:"hidden lg:flex flex-shrink-0 flex-col",children:e.jsx(ne,{onSendMessage:L,onOpenApiKeyDialog:()=>I(!0)})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(ie,{onResize:j})}),e.jsx("div",{style:{width:`${V}px`},className:"hidden lg:flex flex-shrink-0 flex-col",children:e.jsx(ae,{shader:r,onChange:o,readOnly:s})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(ie,{onResize:F})}),e.jsxs("div",{className:"hidden lg:flex flex-1 flex-col overflow-hidden",children:[e.jsx(J,{shader:r,onValuesChange:b}),e.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-black rounded-lg overflow-hidden",children:e.jsx(X,{shader:r,vertexShader:t,customUniforms:g})})})]})]}),e.jsx("footer",{className:"bg-gray-800 border-t border-gray-700 p-2 text-center text-xs text-gray-400",children:"Powered by Claude & WebGPU | Chat to iteratively refine your shader"}),e.jsx(Be,{isOpen:w,onClose:()=>y(!1),currentShader:r,currentVertexShader:t,currentMessages:n,currentUniforms:g,onLoadProject:z,currentProjectId:u}),e.jsx(et,{isOpen:C,onClose:()=>I(!1),allowCancel:Z()!==null})]})}Q.createRoot(document.getElementById("root")).render(e.jsx(be.StrictMode,{children:e.jsx(st,{})}));
