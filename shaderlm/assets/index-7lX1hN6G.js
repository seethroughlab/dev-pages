var pe=Object.defineProperty;var ge=(s,t,r)=>t in s?pe(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var b=(s,t,r)=>ge(s,typeof t!="symbol"?t+"":t,r);import{r as m,j as e,a as ve,E as ye,w as be,R as we}from"./codemirror-DZYbYuHY.js";import{r as je,c as Ne}from"./react-vendor-Cm8h8Ov8.js";import{A as ce}from"./anthropic-DOVQwx1S.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();var ee={},se=je;ee.createRoot=se.createRoot,ee.hydrateRoot=se.hydrateRoot;const re="shaderlm-conversation",_=s=>{try{const t={messages:s.messages,currentShader:s.currentShader,vertexShader:s.vertexShader,shaderHistory:s.shaderHistory,lastUpdated:Date.now()};localStorage.setItem(re,JSON.stringify(t))}catch(t){console.error("Failed to save conversation to localStorage:",t)}},Se=()=>{try{const s=localStorage.getItem(re);if(!s)return null;const t=JSON.parse(s);return!t.messages||!Array.isArray(t.messages)?null:t}catch(s){return console.error("Failed to load conversation from localStorage:",s),null}},ke=()=>{try{localStorage.removeItem(re)}catch(s){console.error("Failed to clear conversation from localStorage:",s)}};let Y=null;async function de(){if(Y)return Y;if(!navigator.gpu)throw new Error("WebGPU is not supported in this browser");const s=await navigator.gpu.requestAdapter();if(!s)throw new Error("Failed to get GPU adapter");const t=await s.requestDevice();return Y=t,t}async function Ce(s){try{const n=await(await de()).createShaderModule({code:s,label:"Validation Shader"}).getCompilationInfo(),o=n.messages.filter(c=>c.type==="error"),a=n.messages.filter(c=>c.type==="warning").map(c=>`Line ${c.lineNum}: ${c.message}`);if(o.length>0)return{success:!1,error:o.map(u=>`Line ${u.lineNum}: ${u.message}`).join(`
`),warnings:a.length>0?a:void 0};const i=Ee(s);return{success:!0,warnings:a.length>0?a:void 0,metadata:i}}catch(t){return{success:!1,error:t instanceof Error?t.message:"Unknown validation error"}}}function Ee(s){const t=s.match(/@(?:vertex|fragment|compute)\s+fn\s+(\w+)/),r=t?t[1]:"main",o=s.includes("@compute")?"compute":"render",a=/@group\((\d+)\)\s+@binding\((\d+)\)\s+var(?:<([^>]+)>)?\s+(\w+):\s*(\w+)/g,i=[];let c;for(;(c=a.exec(s))!==null;){const[,h,x,p,,j]=c;let w="uniform";p!=null&&p.includes("storage")?w="storage":j.includes("texture")?w="texture":j.includes("sampler")&&(w="sampler"),i.push({group:parseInt(h),binding:parseInt(x),type:w,visibility:"all"})}const u=/@location\((\d+)\)\s+(\w+):\s*([^,\)]+)/g,l=[];for(;(c=u.exec(s))!==null;)l.push({location:parseInt(c[1]),name:c[2],type:c[3].trim()});return{entryPoint:r,bindingLayout:i,usage:o,inputs:l.length>0?l:void 0}}function ne(){return{supported:"gpu"in navigator}}function ue(s){const t=[],r=s.match(/struct\s+Uniforms\s*\{([^}]+)\}/);if(!r)return t;const n=r[1],o=/(\w+):\s*(f32|i32|u32|vec2<f32>|vec3<f32>|vec4<f32>)\s*,?/g;let a;for(;(a=o.exec(n))!==null;){const i=a[1],c=a[2];if(i==="time"||i==="resolution"||i==="mouse"||i==="mouseClick"||i==="mouseDown")continue;const u=Pe(i,c);t.push(u)}return t}function Pe(s,t){const r=s.toLowerCase();if(t==="f32"||t==="i32"||t==="u32"){let n=1,o=0,a=10,i=.1;return r.includes("count")||r.includes("num")||r.includes("rows")||r.includes("columns")?(n=5,o=1,a=20,i=1):r.includes("speed")?(n=1,o=0,a=5,i=.1):r.includes("scale")?(n=1,o=.1,a=5,i=.1):r.includes("radius")||r.includes("size")?(n=.5,o=0,a=2,i=.05):(r.includes("intensity")||r.includes("strength"))&&(n=1,o=0,a=2,i=.1),{name:s,type:t,defaultValue:n,min:o,max:a,step:i}}return t==="vec2<f32>"?{name:s,type:t,defaultValue:[.5,.5],min:-2,max:2,step:.05}:t==="vec3<f32>"?{name:s,type:t,defaultValue:[1,1,1],min:0,max:1,step:.01}:t==="vec4<f32>"?{name:s,type:t,defaultValue:[1,1,1,1],min:0,max:1,step:.01}:{name:s,type:t,defaultValue:1,min:0,max:10,step:.1}}function Le(s){const t=new Map;let r=0;t.set("time",0),r+=4,r=F(r,8),t.set("resolution",r),r+=8,r=F(r,8),t.set("mouse",r),r+=8,r=F(r,8),t.set("mouseClick",r),r+=8,r=F(r,4),t.set("mouseDown",r),r+=4;for(const o of s){const{size:a,alignment:i}=Me(o.type);r=F(r,i),t.set(o.name,r),r+=a}return{size:F(r,16),offsets:t}}function Me(s){switch(s){case"f32":case"i32":case"u32":return{size:4,alignment:4};case"vec2<f32>":return{size:8,alignment:8};case"vec3<f32>":return{size:12,alignment:16};case"vec4<f32>":return{size:16,alignment:16};default:return{size:4,alignment:4}}}function F(s,t){return Math.ceil(s/t)*t}function Ae(s,t,r,n,o,a,i,c){const u=new Float32Array(c.size/4),l=c.offsets.get("time")/4;u[l]=s;const h=c.offsets.get("resolution")/4;u[h]=t[0],u[h+1]=t[1];const x=c.offsets.get("mouse")/4;u[x]=r[0],u[x+1]=r[1];const p=c.offsets.get("mouseClick")/4;u[p]=n[0],u[p+1]=n[1];const j=c.offsets.get("mouseDown")/4;u[j]=o;for(const w of i){const v=c.offsets.get(w.name)/4,d=a[w.name]??w.defaultValue;if(Array.isArray(d))for(let y=0;y<d.length;y++)u[v+y]=d[y];else u[v]=d}return u}class De{constructor(){b(this,"device",null);b(this,"context",null);b(this,"pipeline",null);b(this,"uniformBuffer",null);b(this,"bindGroup",null);b(this,"animationId",null);b(this,"startTime",0);b(this,"uniformFields",[]);b(this,"uniformLayout",null);b(this,"customUniformValues",{});b(this,"canvas",null);b(this,"mousePos",[0,0]);b(this,"mouseClick",[0,0]);b(this,"mouseDown",0);b(this,"handleMouseMove",t=>{if(!this.canvas)return;const r=this.canvas.getBoundingClientRect();this.mousePos=[t.clientX-r.left,this.canvas.height-(t.clientY-r.top)]});b(this,"handleMouseDown",t=>{if(this.mouseDown=1,!this.canvas)return;const r=this.canvas.getBoundingClientRect();this.mouseClick=[t.clientX-r.left,this.canvas.height-(t.clientY-r.top)]});b(this,"handleMouseUp",()=>{this.mouseDown=0});b(this,"handleMouseLeave",()=>{this.mouseDown=0});b(this,"handleTouchMove",t=>{if(t.preventDefault(),!this.canvas||!t.touches[0])return;const r=this.canvas.getBoundingClientRect(),n=t.touches[0];this.mousePos=[n.clientX-r.left,this.canvas.height-(n.clientY-r.top)]});b(this,"handleTouchStart",t=>{if(this.mouseDown=1,!this.canvas||!t.touches[0])return;const r=this.canvas.getBoundingClientRect(),n=t.touches[0];this.mouseClick=[n.clientX-r.left,this.canvas.height-(n.clientY-r.top)],this.mousePos=[...this.mouseClick]});b(this,"handleTouchEnd",()=>{this.mouseDown=0})}async initialize(t){this.device=await de(),this.canvas=t;const r=t.getContext("webgpu");if(!r)throw new Error("Failed to get WebGPU context");this.context=r;const n=navigator.gpu.getPreferredCanvasFormat();r.configure({device:this.device,format:n,alphaMode:"premultiplied"}),t.addEventListener("mousemove",this.handleMouseMove),t.addEventListener("mousedown",this.handleMouseDown),t.addEventListener("mouseup",this.handleMouseUp),t.addEventListener("mouseleave",this.handleMouseLeave),t.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),t.addEventListener("touchstart",this.handleTouchStart),t.addEventListener("touchend",this.handleTouchEnd)}async renderShader(t,r,n){if(!this.device||!this.context)throw new Error("Renderer not initialized");this.cleanup(),this.uniformFields=ue(r),this.uniformLayout=Le(this.uniformFields),this.customUniformValues={},this.uniformFields.forEach(u=>{this.customUniformValues[u.name]=u.defaultValue});const o=this.device.createShaderModule({code:t,label:"Vertex Shader"}),a=this.device.createShaderModule({code:r,label:"Fragment Shader"});this.uniformBuffer=this.device.createBuffer({size:this.uniformLayout.size,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});const i=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]});this.bindGroup=this.device.createBindGroup({layout:i,entries:[{binding:0,resource:{buffer:this.uniformBuffer}}]});const c=this.device.createPipelineLayout({bindGroupLayouts:[i]});this.pipeline=this.device.createRenderPipeline({layout:c,vertex:{module:o,entryPoint:(n==null?void 0:n.entryPoint)||"vs_main"},fragment:{module:a,entryPoint:"fs_main",targets:[{format:navigator.gpu.getPreferredCanvasFormat()}]},primitive:{topology:"triangle-list"}}),this.startTime=Date.now(),this.startAnimation()}startAnimation(){const t=()=>{this.frame(),this.animationId=requestAnimationFrame(t)};t()}updateCustomUniforms(t){this.customUniformValues={...this.customUniformValues,...t}}frame(){if(!this.device||!this.context||!this.pipeline||!this.uniformBuffer||!this.bindGroup||!this.uniformLayout)return;const t=this.context.canvas,r=(Date.now()-this.startTime)/1e3,n=Ae(r,[t.width,t.height],this.mousePos,this.mouseClick,this.mouseDown,this.customUniformValues,this.uniformFields,this.uniformLayout);this.device.queue.writeBuffer(this.uniformBuffer,0,n.buffer,n.byteOffset,n.byteLength);const o=this.device.createCommandEncoder(),a=this.context.getCurrentTexture().createView(),i=o.beginRenderPass({colorAttachments:[{view:a,clearValue:{r:0,g:0,b:0,a:1},loadOp:"clear",storeOp:"store"}]});i.setPipeline(this.pipeline),i.setBindGroup(0,this.bindGroup),i.draw(3),i.end(),this.device.queue.submit([o.finish()])}cleanup(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.uniformBuffer&&(this.uniformBuffer.destroy(),this.uniformBuffer=null),this.pipeline=null,this.bindGroup=null}destroy(){this.cleanup(),this.canvas&&(this.canvas.removeEventListener("mousemove",this.handleMouseMove),this.canvas.removeEventListener("mousedown",this.handleMouseDown),this.canvas.removeEventListener("mouseup",this.handleMouseUp),this.canvas.removeEventListener("mouseleave",this.handleMouseLeave),this.canvas.removeEventListener("touchmove",this.handleTouchMove),this.canvas.removeEventListener("touchstart",this.handleTouchStart),this.canvas.removeEventListener("touchend",this.handleTouchEnd)),this.canvas=null,this.device=null,this.context=null}}const Ie=`
@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> @builtin(position) vec4<f32> {
    // Full-screen triangle
    var pos = array<vec2<f32>, 3>(
        vec2<f32>(-1.0, -1.0),
        vec2<f32>(3.0, -1.0),
        vec2<f32>(-1.0, 3.0)
    );
    return vec4<f32>(pos[vertexIndex], 0.0, 1.0);
}
`,Ue=()=>`${Date.now()}-${Math.random().toString(36).substring(2,9)}`,oe={messages:[],currentShader:"",vertexShader:Ie,isGenerating:!1,error:null,shaderHistory:[]},me=Ne(s=>({...oe,addMessage:t=>{const r={...t,id:Ue(),timestamp:Date.now()};s(n=>{const o=[...n.messages,r];return _({messages:o,currentShader:n.currentShader,vertexShader:n.vertexShader,shaderHistory:n.shaderHistory}),{messages:o}})},updateLastMessage:t=>{s(r=>{const n=[...r.messages];return n.length>0&&(n[n.length-1]={...n[n.length-1],content:t}),_({messages:n,currentShader:r.currentShader,vertexShader:r.vertexShader,shaderHistory:r.shaderHistory}),{messages:n}})},setCurrentShader:(t,r)=>{s(n=>{const o=r?[...n.shaderHistory,{code:t,timestamp:Date.now(),messageId:r}]:n.shaderHistory;return _({messages:n.messages,currentShader:t,vertexShader:n.vertexShader,shaderHistory:o}),{currentShader:t,shaderHistory:o}})},setVertexShader:t=>{s(r=>(_({messages:r.messages,currentShader:r.currentShader,vertexShader:t,shaderHistory:r.shaderHistory}),{vertexShader:t}))},setIsGenerating:t=>{s({isGenerating:t})},setError:t=>{s({error:t})},clearConversation:()=>{ke(),s(oe)},loadFromStorage:()=>{const t=Se();t&&s({messages:t.messages,currentShader:t.currentShader,vertexShader:t.vertexShader,shaderHistory:t.shaderHistory})}})),Re=["A colorful animated gradient","A pulsing circle with glow effect","Wavy water effect","Fractal noise pattern","Rotating rainbow spiral"];function X({onSendMessage:s,onOpenApiKeyDialog:t}){const[r,n]=m.useState(""),o=m.useRef(null),a=m.useRef(null),{messages:i,isGenerating:c,clearConversation:u}=me(),l=()=>{var d;(d=o.current)==null||d.scrollIntoView({behavior:"smooth"})};m.useEffect(()=>{l()},[i]);const h=d=>{d.preventDefault(),r.trim()&&!c&&(s(r.trim()),n(""))},x=d=>{d.key==="Enter"&&(d.ctrlKey||d.metaKey)&&(d.preventDefault(),h(d))},p=d=>{var y;c||(n(d),(y=a.current)==null||y.focus())},j=d=>{navigator.clipboard.writeText(d)},w=d=>new Date(d).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),v=()=>{window.confirm("Are you sure you want to clear the conversation? This cannot be undone.")&&u()};return e.jsxs("div",{className:"flex flex-col h-full bg-gray-800 md:border-r border-gray-700",children:[e.jsxs("div",{className:"flex-shrink-0 p-3 md:p-4 border-b border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base md:text-lg font-semibold text-white",children:"Shader Chat"}),e.jsxs("div",{className:"flex items-center gap-1 md:gap-2",children:[e.jsx("button",{onClick:t,className:"p-2 md:p-1.5 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors touch-manipulation",title:"Edit API Key",children:e.jsx("svg",{className:"w-5 h-5 md:w-4 md:h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})})}),i.length>0&&e.jsx("button",{onClick:v,className:"text-xs md:text-xs px-3 py-2 md:px-2 md:py-1 text-gray-400 hover:text-white hover:bg-gray-700 rounded transition-colors touch-manipulation",title:"Clear conversation",children:"Clear"})]})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1 hidden sm:block",children:"Describe shaders and refine them iteratively"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 md:p-4 space-y-3 md:space-y-4",children:[i.length===0?e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{className:"text-center text-gray-400 py-4 md:py-8",children:[e.jsx("svg",{className:"w-12 h-12 md:w-16 md:h-16 mx-auto mb-3 md:mb-4 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"})}),e.jsx("p",{className:"text-sm mb-2",children:"Start a conversation to generate a shader"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Try one of these examples:"})]}),e.jsx("div",{className:"space-y-2",children:Re.map((d,y)=>e.jsx("button",{onClick:()=>p(d),disabled:c,className:"w-full text-left px-4 py-3 bg-gray-700 hover:bg-gray-600 active:bg-gray-600 disabled:bg-gray-800 disabled:cursor-not-allowed rounded-lg transition-colors text-sm touch-manipulation",children:d},y))})]}):e.jsxs(e.Fragment,{children:[i.map(d=>{var y;return e.jsx("div",{className:`flex ${d.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[85%] rounded-lg px-4 py-2 ${d.role==="user"?"bg-blue-600 text-white":d.role==="system"?"bg-red-900 text-red-100":"bg-gray-700 text-gray-100"}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("div",{className:"flex-1 whitespace-pre-wrap break-words text-sm",children:d.content}),d.role==="assistant"&&e.jsx("button",{onClick:()=>j(d.content),className:"flex-shrink-0 text-gray-400 hover:text-white transition-colors",title:"Copy message",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]}),e.jsx("div",{className:"text-xs mt-1 opacity-70",children:w(d.timestamp)}),((y=d.metadata)==null?void 0:y.validationError)&&e.jsx("div",{className:"mt-2 p-2 bg-red-900/50 rounded text-xs font-mono",children:d.metadata.validationError})]})},d.id)}),c&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-700 text-gray-100 rounded-lg px-4 py-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),e.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),e.jsx("span",{className:"text-sm text-gray-400",children:"Generating..."})]})})})]}),e.jsx("div",{ref:o})]}),e.jsx("div",{className:"flex-shrink-0 p-3 md:p-4 border-t border-gray-700",children:e.jsxs("form",{onSubmit:h,className:"space-y-2",children:[e.jsx("textarea",{ref:a,value:r,onChange:d=>n(d.target.value),onKeyDown:x,placeholder:i.length===0?"Describe the shader you want to create...":"Describe how to refine the shader...",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none text-white placeholder-gray-400 text-sm md:text-sm",rows:3,disabled:c}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-xs text-gray-500 hidden sm:block",children:"Ctrl+Enter to send"}),e.jsx("button",{type:"submit",disabled:!r.trim()||c,className:"px-4 py-2 md:py-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded-lg font-medium transition-colors text-sm touch-manipulation ml-auto",children:c?"Generating...":"Send"})]})]})})]})}function J({shader:s,onChange:t,readOnly:r}){return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"bg-gray-800 px-3 md:px-4 py-2 border-b border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-sm font-semibold truncate",children:"Fragment Shader (WGSL)"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(s)},className:"text-xs px-3 py-2 md:py-1 bg-gray-700 hover:bg-gray-600 active:bg-gray-600 rounded transition-colors touch-manipulation ml-2",disabled:!s,children:"Copy"})]}),e.jsx("div",{className:"flex-1 overflow-auto",children:e.jsx(ve,{value:s,height:"100%",theme:"dark",extensions:[ye.lineWrapping,be()],onChange:t,readOnly:r,basicSetup:{lineNumbers:!0,highlightActiveLineGutter:!0,highlightActiveLine:!0,foldGutter:!0,dropCursor:!0,indentOnInput:!0,syntaxHighlighting:!0,bracketMatching:!0,autocompletion:!0},placeholder:"Your generated shader will appear here...",className:"code-editor"})})]})}function Q({shader:s,vertexShader:t,customUniforms:r}){const n=m.useRef(null),o=m.useRef(null),a=m.useRef(null),[i,c]=m.useState(null),[u,l]=m.useState(!1),[h,x]=m.useState(!1),[p,j]=m.useState(!1);m.useEffect(()=>{const v=n.current;return v?((async()=>{try{a.current||(a.current=new De,await a.current.initialize(v),x(!0))}catch(y){c(y instanceof Error?y.message:"Failed to initialize WebGPU")}})(),()=>{a.current&&(a.current.destroy(),a.current=null),x(!1)}):void 0},[]),m.useEffect(()=>{if(!s||!a.current||!h)return;(async()=>{c(null),l(!0);try{await a.current.renderShader(t,s)}catch(d){c(d instanceof Error?d.message:"Failed to render shader")}finally{l(!1)}})()},[s,t,h]),m.useEffect(()=>{r&&a.current&&h&&a.current.updateCustomUniforms(r)},[r,h]),m.useEffect(()=>{const v=n.current;if(!v)return;const d=new ResizeObserver(y=>{for(const A of y){const{width:L,height:E}=A.contentRect;v.width=L*devicePixelRatio,v.height=E*devicePixelRatio}});return d.observe(v),()=>{d.disconnect()}},[]),m.useEffect(()=>{const v=()=>{j(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",v),()=>{document.removeEventListener("fullscreenchange",v)}},[]);const w=async()=>{const v=o.current;if(v)try{document.fullscreenElement?await document.exitFullscreen():await v.requestFullscreen()}catch(d){console.error("Error toggling fullscreen:",d)}};return e.jsxs("div",{ref:o,className:"relative w-full h-full",children:[e.jsx("canvas",{ref:n,className:"w-full h-full",style:{imageRendering:"pixelated"}}),e.jsx("button",{onClick:w,className:"absolute top-2 md:top-4 left-2 md:left-4 bg-gray-800/80 hover:bg-gray-700/90 active:bg-gray-700/90 text-white p-2 md:p-2 rounded transition-colors backdrop-blur-sm touch-manipulation",title:p?"Exit Fullscreen":"Enter Fullscreen",children:p?e.jsx("svg",{className:"w-5 h-5 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):e.jsx("svg",{className:"w-5 h-5 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),!s&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 px-4",children:e.jsx("p",{className:"text-gray-400 text-sm md:text-base text-center",children:"Generate a shader to see preview"})}),u&&e.jsx("div",{className:"absolute top-2 md:top-4 right-2 md:right-4 bg-blue-600 text-white text-xs px-3 py-1 rounded-full",children:"Rendering..."}),i&&e.jsxs("div",{className:"absolute bottom-2 md:bottom-4 left-2 md:left-4 right-2 md:right-4 bg-red-900/90 border border-red-500 text-red-200 text-xs md:text-sm p-2 md:p-3 rounded",children:[e.jsx("strong",{children:"Render Error:"})," ",i]})]})}function Z({shader:s,onValuesChange:t}){const[r,n]=m.useState([]),[o,a]=m.useState({});m.useEffect(()=>{const l=ue(s);n(l);const h={};l.forEach(x=>{h[x.name]=x.defaultValue}),a(h),l.length>0&&t(h)},[s,t]);const i=(l,h)=>{const x={...o,[l]:h};a(x),t(x)},c=(l,h)=>{const x=parseFloat(h);isNaN(x)||i(l,x)},u=(l,h,x)=>{const p=parseFloat(x);if(!isNaN(p)){const w=[...o[l]];w[h]=p,i(l,w)}};return r.length===0?null:e.jsxs("div",{className:"p-2 md:p-4 bg-gray-800 border-b border-gray-700",children:[e.jsx("h3",{className:"text-xs md:text-sm font-semibold mb-2 md:mb-3 text-gray-200",children:"Shader Uniforms"}),e.jsx("div",{className:"space-y-2 md:space-y-3 max-h-40 md:max-h-48 overflow-y-auto",children:r.map(l=>e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-xs font-medium text-gray-300 capitalize",children:l.name.replace(/([A-Z])/g," $1").trim()}),(l.type==="f32"||l.type==="i32"||l.type==="u32")&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"range",min:l.min,max:l.max,step:l.step,value:o[l.name],onChange:h=>c(l.name,h.target.value),className:"flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500 touch-manipulation"}),e.jsx("input",{type:"number",min:l.min,max:l.max,step:l.step,value:o[l.name],onChange:h=>c(l.name,h.target.value),className:"w-14 md:w-16 px-2 py-1.5 md:py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]}),l.type==="vec2<f32>"&&e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["x","y"].map((h,x)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:h}),e.jsx("input",{type:"number",min:l.min,max:l.max,step:l.step,value:o[l.name][x],onChange:p=>u(l.name,x,p.target.value),className:"w-full px-2 py-1.5 md:py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]},h))}),l.type==="vec3<f32>"&&e.jsx("div",{className:"grid grid-cols-3 gap-1.5 md:gap-2",children:["x","y","z"].map((h,x)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:h}),e.jsx("input",{type:"number",min:l.min,max:l.max,step:l.step,value:o[l.name][x],onChange:p=>u(l.name,x,p.target.value),className:"w-full px-1.5 md:px-2 py-1.5 md:py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]},h))}),l.type==="vec4<f32>"&&e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-1.5 md:gap-2",children:["x","y","z","w"].map((h,x)=>e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:h}),e.jsx("input",{type:"number",min:l.min,max:l.max,step:l.step,value:o[l.name][x],onChange:p=>u(l.name,x,p.target.value),className:"w-full px-1.5 md:px-2 py-1.5 md:py-1 text-xs bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-1 focus:ring-blue-500"})]},h))})]},l.name))})]})}const Fe="ShaderLM",Te=1,k="projects";let H=null;async function z(){return H||new Promise((s,t)=>{const r=indexedDB.open(Fe,Te);r.onerror=()=>{t(new Error("Failed to open IndexedDB"))},r.onsuccess=()=>{H=r.result,s(H)},r.onupgradeneeded=n=>{const o=n.target.result;if(!o.objectStoreNames.contains(k)){const a=o.createObjectStore(k,{keyPath:"id",autoIncrement:!0});a.createIndex("name","name",{unique:!1}),a.createIndex("createdAt","createdAt",{unique:!1}),a.createIndex("updatedAt","updatedAt",{unique:!1})}}})}async function ae(s){const t=await z();return new Promise((r,n)=>{const a=t.transaction([k],"readwrite").objectStore(k),i={...s,updatedAt:Date.now()},c=a.add(i);c.onsuccess=()=>{r(c.result)},c.onerror=()=>{n(new Error("Failed to save project"))}})}async function Ve(s){if(!s.id)throw new Error("Project ID is required for update");const t=await z();return new Promise((r,n)=>{const a=t.transaction([k],"readwrite").objectStore(k),i={...s,updatedAt:Date.now()},c=a.put(i);c.onsuccess=()=>{r()},c.onerror=()=>{n(new Error("Failed to update project"))}})}async function ze(s){const t=await z();return new Promise((r,n)=>{const i=t.transaction([k],"readonly").objectStore(k).get(s);i.onsuccess=()=>{r(i.result||null)},i.onerror=()=>{n(new Error("Failed to load project"))}})}async function Oe(){const s=await z();return new Promise((t,r)=>{const a=s.transaction([k],"readonly").objectStore(k).getAll();a.onsuccess=()=>{const i=a.result||[];i.sort((c,u)=>u.updatedAt-c.updatedAt),t(i)},a.onerror=()=>{r(new Error("Failed to load projects"))}})}async function Ge(s){const t=await z();return new Promise((r,n)=>{const i=t.transaction([k],"readwrite").objectStore(k).delete(s);i.onsuccess=()=>{r()},i.onerror=()=>{n(new Error("Failed to delete project"))}})}function We(s){return JSON.stringify(s,null,2)}function Be(s){const t=JSON.parse(s),{id:r,...n}=t;if(!t.name||!t.shader||!t.messages)throw new Error("Invalid project format");return{...n,createdAt:Date.now(),updatedAt:Date.now()}}function _e({isOpen:s,onClose:t,currentShader:r,currentVertexShader:n,currentMessages:o,currentUniforms:a,onLoadProject:i,currentProjectId:c}){const[u,l]=m.useState([]),[h,x]=m.useState(!1),[p,j]=m.useState(!1),[w,v]=m.useState(!1),[d,y]=m.useState(""),[A,L]=m.useState(""),[E,D]=m.useState("");m.useEffect(()=>{s&&S()},[s]);const S=async()=>{x(!0);try{const f=await Oe();l(f)}catch(f){console.error("Failed to load projects:",f)}finally{x(!1)}},O=async()=>{if(!d.trim()){alert("Please enter a project name");return}j(!0);try{const f={name:d.trim(),description:A.trim()||void 0,shader:r,vertexShader:n,messages:o,customUniforms:a,createdAt:Date.now(),updatedAt:Date.now()};c?await Ve({...f,id:c}):await ae(f),v(!1),y(""),L(""),await S()}catch(f){console.error("Failed to save project:",f),alert("Failed to save project")}finally{j(!1)}},T=async f=>{try{const N=await ze(f);N&&(i(N),t())}catch(N){console.error("Failed to load project:",N),alert("Failed to load project")}},K=async f=>{if(window.confirm("Are you sure you want to delete this project?"))try{await Ge(f),await S()}catch(N){console.error("Failed to delete project:",N),alert("Failed to delete project")}},V=f=>{const N=We(f),I=new Blob([N],{type:"application/json"}),P=URL.createObjectURL(I),M=document.createElement("a");M.href=P,M.download=`${f.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.json`,M.click(),URL.revokeObjectURL(P)},$=()=>{const f=document.createElement("input");f.type="file",f.accept=".json",f.onchange=async N=>{var P;const I=(P=N.target.files)==null?void 0:P[0];if(I)try{const M=await I.text(),g=Be(M);await ae(g),await S()}catch(M){console.error("Failed to import project:",M),alert("Failed to import project. Please check the file format.")}},f.click()},G=E?u.filter(f=>{var N;return f.name.toLowerCase().includes(E.toLowerCase())||((N=f.description)==null?void 0:N.toLowerCase().includes(E.toLowerCase()))}):u;return s?e.jsxs("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-0 md:p-4",children:[e.jsxs("div",{className:"bg-gray-800 rounded-none md:rounded-lg shadow-xl max-w-4xl w-full h-full md:max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 md:p-4 border-b border-gray-700",children:[e.jsx("h2",{className:"text-lg md:text-xl font-bold text-white",children:"Project Manager"}),e.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors p-2 touch-manipulation",children:e.jsx("svg",{className:"w-5 h-5 md:w-6 md:h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"p-3 md:p-4 border-b border-gray-700 space-y-2 md:space-y-3",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>v(!0),disabled:!r,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded font-medium transition-colors text-sm touch-manipulation",children:"Save Current Project"}),e.jsx("button",{onClick:$,className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 active:bg-gray-600 rounded font-medium transition-colors text-sm touch-manipulation",children:"Import"})]}),e.jsx("input",{type:"text",placeholder:"Search projects...",value:E,onChange:f=>D(f.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400 text-sm"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 md:p-4",children:h?e.jsx("div",{className:"text-center text-gray-400 py-8 text-sm md:text-base",children:"Loading projects..."}):G.length===0?e.jsx("div",{className:"text-center text-gray-400 py-8 text-sm md:text-base",children:E?"No projects found":"No saved projects yet"}):e.jsx("div",{className:"space-y-2 md:space-y-3",children:G.map(f=>e.jsx("div",{className:"bg-gray-700 rounded-lg p-3 md:p-4 hover:bg-gray-600 transition-colors",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-white text-sm md:text-base truncate",children:f.name}),f.description&&e.jsx("p",{className:"text-xs md:text-sm text-gray-400 mt-1 line-clamp-2",children:f.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 md:gap-4 mt-2 text-xs text-gray-500",children:[e.jsxs("span",{className:"whitespace-nowrap",children:["Created: ",new Date(f.createdAt).toLocaleDateString()]}),e.jsxs("span",{className:"whitespace-nowrap",children:["Updated: ",new Date(f.updatedAt).toLocaleDateString()]}),e.jsxs("span",{className:"whitespace-nowrap",children:[f.messages.length," messages"]})]})]}),e.jsxs("div",{className:"flex gap-2 sm:ml-4 flex-wrap sm:flex-nowrap",children:[e.jsx("button",{onClick:()=>T(f.id),className:"flex-1 sm:flex-none px-3 py-2 md:py-1 bg-blue-600 hover:bg-blue-700 active:bg-blue-700 rounded text-sm transition-colors touch-manipulation",children:"Load"}),e.jsx("button",{onClick:()=>V(f),className:"flex-1 sm:flex-none px-3 py-2 md:py-1 bg-gray-800 hover:bg-gray-900 active:bg-gray-900 rounded text-sm transition-colors touch-manipulation",title:"Export as JSON",children:"Export"}),e.jsx("button",{onClick:()=>K(f.id),className:"flex-1 sm:flex-none px-3 py-2 md:py-1 bg-red-600 hover:bg-red-700 active:bg-red-700 rounded text-sm transition-colors touch-manipulation",children:"Delete"})]})]})},f.id))})})]}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-4 md:p-6",children:[e.jsx("h3",{className:"text-base md:text-lg font-bold text-white mb-3 md:mb-4",children:"Save Project"}),e.jsxs("div",{className:"space-y-3 md:space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs md:text-sm font-medium text-gray-300 mb-1",children:"Project Name *"}),e.jsx("input",{type:"text",value:d,onChange:f=>y(f.target.value),placeholder:"My Awesome Shader",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400 text-sm",autoFocus:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs md:text-sm font-medium text-gray-300 mb-1",children:"Description (optional)"}),e.jsx("textarea",{value:A,onChange:f=>L(f.target.value),placeholder:"A beautiful animated gradient shader...",rows:3,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-white placeholder-gray-400 resize-none text-sm"})]}),e.jsxs("div",{className:"flex gap-2 justify-end flex-col-reverse sm:flex-row",children:[e.jsx("button",{onClick:()=>{v(!1),y(""),L("")},className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 active:bg-gray-600 rounded font-medium transition-colors text-sm touch-manipulation",children:"Cancel"}),e.jsx("button",{onClick:O,disabled:!d.trim()||p,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-700 disabled:bg-gray-600 disabled:cursor-not-allowed rounded font-medium transition-colors text-sm touch-manipulation",children:p?"Saving...":"Save"})]})]})]})})]}):null}function ie({onResize:s}){const t=m.useRef(!1),r=m.useRef(0);m.useEffect(()=>{const a=l=>{if(!t.current)return;const h=l.clientX-r.current;r.current=l.clientX,s(h)},i=()=>{t.current=!1,document.body.style.cursor="",document.body.style.userSelect=""},c=l=>{if(!t.current||!l.touches[0])return;const h=l.touches[0].clientX-r.current;r.current=l.touches[0].clientX,s(h),l.preventDefault()},u=()=>{t.current=!1,document.body.style.userSelect=""};return document.addEventListener("mousemove",a),document.addEventListener("mouseup",i),document.addEventListener("touchmove",c,{passive:!1}),document.addEventListener("touchend",u),()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",i),document.removeEventListener("touchmove",c),document.removeEventListener("touchend",u)}},[s]);const n=a=>{t.current=!0,r.current=a.clientX,document.body.style.cursor="col-resize",document.body.style.userSelect="none",a.preventDefault()},o=a=>{a.touches[0]&&(t.current=!0,r.current=a.touches[0].clientX,document.body.style.userSelect="none",a.preventDefault())};return e.jsx("div",{onMouseDown:n,onTouchStart:o,className:"w-1 md:w-2 bg-gray-700 hover:bg-blue-500 active:bg-blue-600 cursor-col-resize transition-colors flex-shrink-0 group relative touch-none",children:e.jsx("div",{className:"absolute inset-y-0 -left-2 -right-2 md:-left-4 md:-right-4"})})}const He=`You are an expert WebGPU shader developer specializing in WGSL (WebGPU Shading Language).

Key WGSL Rules:
- WGSL has STRICT typing with NO implicit conversions
- All functions must have explicit return types
- Entry points must use @vertex, @fragment, or @compute attributes
- Bindings use @group(N) @binding(M) decorations
- Built-in values use @builtin() attribute
- Workgroup size for compute: @workgroup_size(X, Y, Z)

Common WGSL Functions:
- Math: sin, cos, tan, sqrt, pow, abs, floor, ceil, round, clamp, mix, smoothstep
- Vector: dot, cross, length, normalize, distance, reflect
- Texture: textureSample, textureLoad, textureDimensions
- No function overloading - functions must have unique names

Type Syntax:
- Scalars: f32, i32, u32, bool
- Vectors: vec2<f32>, vec3<f32>, vec4<f32>
- Matrices: mat2x2<f32>, mat3x3<f32>, mat4x4<f32>
- Arrays: array<f32, 10> or array<f32>

IMPORTANT: Always use f32 literals with decimal point (e.g., 1.0, not 1)`,Ke=`
Example 1: Simple Triangle Vertex + Fragment Shader
\`\`\`wgsl
@vertex
fn vs_main(@builtin(vertex_index) vertexIndex: u32) -> @builtin(position) vec4<f32> {
    var pos = array<vec2<f32>, 3>(
        vec2<f32>(0.0, 0.5),
        vec2<f32>(-0.5, -0.5),
        vec2<f32>(0.5, -0.5)
    );
    return vec4<f32>(pos[vertexIndex], 0.0, 1.0);
}

@fragment
fn fs_main() -> @location(0) vec4<f32> {
    return vec4<f32>(1.0, 0.0, 0.0, 1.0); // Red
}
\`\`\`

Example 2: Shader with Uniforms
\`\`\`wgsl
struct Uniforms {
    time: f32,
    resolution: vec2<f32>,
    mouse: vec2<f32>,
    mouseClick: vec2<f32>,
    mouseDown: f32,
}

@group(0) @binding(0) var<uniform> uniforms: Uniforms;

@fragment
fn fs_main(@builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {
    let uv = fragCoord.xy / uniforms.resolution;
    let col = 0.5 + 0.5 * cos(uniforms.time + uv.xyx + vec3<f32>(0.0, 2.0, 4.0));
    return vec4<f32>(col, 1.0);
}
\`\`\`

Example 3: Interactive Shader with Mouse
\`\`\`wgsl
struct Uniforms {
    time: f32,
    resolution: vec2<f32>,
    mouse: vec2<f32>,
    mouseClick: vec2<f32>,
    mouseDown: f32,
}

@group(0) @binding(0) var<uniform> uniforms: Uniforms;

@fragment
fn fs_main(@builtin(position) fragCoord: vec4<f32>) -> @location(0) vec4<f32> {
    let uv = fragCoord.xy / uniforms.resolution;
    let mouseUV = uniforms.mouse / uniforms.resolution;

    // Distance from mouse
    let d = distance(uv, mouseUV);
    let glow = 0.1 / (d + 0.01);

    // Pulse with mouse down
    let pulse = 1.0 + uniforms.mouseDown * sin(uniforms.time * 10.0) * 0.5;

    let col = vec3<f32>(glow * pulse);
    return vec4<f32>(col, 1.0);
}
\`\`\`

Example 4: Compute Shader
\`\`\`wgsl
@group(0) @binding(0) var<storage, read_write> data: array<f32>;

@compute @workgroup_size(256)
fn cs_main(@builtin(global_invocation_id) global_id: vec3<u32>) {
    let index = global_id.x;
    data[index] = data[index] * 2.0;
}
\`\`\``;function $e(){return`${He}

${Ke}

You are helping users create and iteratively refine WebGPU shaders through conversation.

When users request a shader:
1. Generate complete WGSL shader code in a \`\`\`wgsl code block
2. Provide a brief explanation of how it works
3. Include any JavaScript setup code needed (in a \`\`\`javascript block)

When users request refinements or modifications:
1. Understand what they want to change
2. Modify the existing shader accordingly
3. Provide the complete updated shader code
4. Explain what you changed and why

If a shader has validation errors:
- The user will share the error message with you
- Fix the issue and provide the corrected shader
- Explain what was wrong and how you fixed it

Available uniforms (automatically provided):
- time: f32 - current time in seconds
- resolution: vec2<f32> - canvas resolution (width, height)
- mouse: vec2<f32> - current mouse/touch position (in pixels, origin at bottom-left)
- mouseClick: vec2<f32> - last click/tap position (persists until next click)
- mouseDown: f32 - 1.0 when mouse/touch is pressed, 0.0 otherwise

You can add custom uniforms to the Uniforms struct for user-controllable parameters:
- The UI will automatically detect and create sliders for custom uniform fields
- Good examples: rows, columns, speed, scale, radius, intensity, etc.
- Users can adjust these values in real-time via the UI

Creating Interactive Shaders:
- Consider making shaders respond to mouse/touch input when appropriate
- Use mouse position to create effects like: glow following cursor, ripples, distortion, color changes
- Combine mouse with time for dynamic, interactive animations
- Convert mouse to normalized UV coordinates: let mouseUV = uniforms.mouse / uniforms.resolution;

Default context:
- A full-screen triangle vertex shader is provided automatically
- You typically only need to write fragment shaders
- Fragment shaders receive @builtin(position) fragCoord which is screen coordinates

Remember:
- Use explicit f32 types (1.0 not 1)
- No implicit type conversions
- Always provide complete, working shader code
- Be conversational and helpful in your explanations`}const he="shaderlm_api_key",qe=365;function Ye(s,t,r){const n=new Date;n.setTime(n.getTime()+r*24*60*60*1e3);const o=`expires=${n.toUTCString()}`;document.cookie=`${s}=${t};${o};path=/;SameSite=Strict`}function Xe(s){const t=`${s}=`,r=document.cookie.split(";");for(let n of r){let o=n.trim();if(o.indexOf(t)===0)return o.substring(t.length)}return null}function te(){return Xe(he)}function Je(s){Ye(he,s,qe)}let fe;function xe(s){const t=s||te();if(!t)throw new Error("No API key available. Please set your Claude API key.");fe=new ce({apiKey:t,dangerouslyAllowBrowser:!0})}function Qe(s){xe(s)}async function Ze(s){try{return await new ce({apiKey:s,dangerouslyAllowBrowser:!0}).messages.create({model:"claude-sonnet-4-20250514",max_tokens:10,messages:[{role:"user",content:"Hi"}]}),{valid:!0}}catch(t){return console.error("API key validation failed:",t),t instanceof Error?{valid:!1,error:t.message}:{valid:!1,error:"Unknown error occurred"}}}try{xe()}catch{console.warn("Claude client not initialized - API key required")}async function*et(s,t){try{const r=await fe.messages.create({model:"claude-sonnet-4-20250514",max_tokens:4e3,system:s,messages:t,stream:!0});for await(const n of r)n.type==="content_block_delta"&&n.delta.type==="text_delta"&&(yield n.delta.text)}catch(r){throw console.error("Error in conversational shader generation:",r),new Error(`Failed to generate shader: ${r instanceof Error?r.message:"Unknown error"}`)}}function tt({isOpen:s,onClose:t,allowCancel:r=!1}){const[n,o]=m.useState(""),[a,i]=m.useState(!1),[c,u]=m.useState(null),l=async()=>{if(!n.trim()){u("Please enter an API key");return}i(!0),u(null);try{const p=await Ze(n.trim());p.valid?(Je(n.trim()),Qe(n.trim()),o(""),t()):u(p.error||"Invalid API key. Please check and try again.")}catch(p){u("Failed to validate API key. Please try again."),console.error("API key validation error:",p)}finally{i(!1)}},h=()=>{r&&(o(""),u(null),t())},x=p=>{p.key==="Enter"&&!a&&l()};return s?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-4 md:p-6",children:[e.jsxs("div",{className:"mb-3 md:mb-4",children:[e.jsx("h2",{className:"text-lg md:text-xl font-semibold text-white mb-2",children:"Enter Claude API Key"}),e.jsxs("p",{className:"text-gray-400 text-xs md:text-sm",children:["Your API key will be stored securely in your browser cookies. Get your key from"," ",e.jsx("a",{href:"https://console.anthropic.com/settings/keys",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:text-blue-300 underline",children:"Anthropic Console"}),"."]})]}),e.jsxs("div",{className:"mb-3 md:mb-4",children:[e.jsx("label",{htmlFor:"apiKey",className:"block text-xs md:text-sm font-medium text-gray-300 mb-2",children:"API Key"}),e.jsx("input",{id:"apiKey",type:"password",value:n,onChange:p=>o(p.target.value),onKeyPress:x,placeholder:"sk-ant-...",disabled:a,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:opacity-50 disabled:cursor-not-allowed"})]}),c&&e.jsx("div",{className:"mb-3 md:mb-4 p-2 md:p-3 bg-red-900/50 border border-red-700 rounded-md",children:e.jsx("p",{className:"text-red-200 text-xs md:text-sm",children:c})}),e.jsxs("div",{className:"flex justify-end gap-2 flex-col-reverse sm:flex-row",children:[r&&e.jsx("button",{onClick:h,disabled:a,className:"px-4 py-2 bg-gray-700 text-white rounded-md hover:bg-gray-600 active:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm touch-manipulation",children:"Cancel"}),e.jsx("button",{onClick:l,disabled:a||!n.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 active:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center justify-center gap-2 text-sm touch-manipulation",children:a?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),e.jsx("span",{children:"Validating..."})]}):"Save"})]})]})}):null}const le=({activeTab:s,onTabChange:t})=>e.jsxs("div",{className:"flex border-b border-gray-700 bg-gray-800",children:[e.jsx("button",{onClick:()=>t("chat"),className:`flex-1 py-3 px-2 text-sm font-medium transition-colors touch-manipulation ${s==="chat"?"bg-gray-700 text-white border-b-2 border-blue-500":"text-gray-400 hover:text-gray-200 hover:bg-gray-750"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),e.jsx("span",{children:"Chat"})]})}),e.jsx("button",{onClick:()=>t("editor"),className:`flex-1 py-3 px-2 text-sm font-medium transition-colors touch-manipulation ${s==="editor"?"bg-gray-700 text-white border-b-2 border-blue-500":"text-gray-400 hover:text-gray-200 hover:bg-gray-750"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})}),e.jsx("span",{children:"Editor"})]})}),e.jsx("button",{onClick:()=>t("preview"),className:`flex-1 py-3 px-2 text-sm font-medium transition-colors touch-manipulation ${s==="preview"?"bg-gray-700 text-white border-b-2 border-blue-500":"text-gray-400 hover:text-gray-200 hover:bg-gray-750"}`,children:e.jsxs("div",{className:"flex items-center justify-center gap-1.5",children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]}),e.jsx("span",{children:"Preview"})]})})]});async function rt(s){const t=s.match(/```wgsl\n([\s\S]*?)```/),r=t?t[1].trim():"",n=s.replace(/```[\s\S]*?```/g,"").trim();if(!r)return{shader:"",isValid:!1,error:"No shader code found in response",explanation:n};const o=await Ce(r);return{shader:r,isValid:o.success,error:o.error,explanation:n}}function st(){const{currentShader:s,vertexShader:t,isGenerating:r,messages:n,setCurrentShader:o,setVertexShader:a,setIsGenerating:i,setError:c,addMessage:u,updateLastMessage:l,loadFromStorage:h,clearConversation:x}=me(),[p,j]=m.useState({}),[w,v]=m.useState(!1),[d,y]=m.useState(),[A,L]=m.useState(),[E,D]=m.useState(!1),[S,O]=m.useState("chat"),[T,K]=m.useState(()=>{const g=localStorage.getItem("chatWidth");return g?parseInt(g,10):384}),[V,$]=m.useState(()=>{const g=localStorage.getItem("editorWidth");return g?parseInt(g,10):500});m.useEffect(()=>{te()||D(!0)},[]),m.useEffect(()=>{h()},[h]),m.useEffect(()=>{localStorage.setItem("chatWidth",T.toString())},[T]),m.useEffect(()=>{localStorage.setItem("editorWidth",V.toString())},[V]),m.useEffect(()=>{ne().supported||c("WebGPU is not supported in your browser")},[c]);const G=m.useCallback(g=>{x(),o(g.shader),g.vertexShader&&a(g.vertexShader),g.messages.forEach(C=>{u({role:C.role,content:C.content,metadata:C.metadata})}),g.customUniforms&&j(g.customUniforms),y(g.id),L(g.name)},[x,o,a,u]),f=()=>{s&&!window.confirm("Starting a new project will clear the current conversation. Are you sure?")||(x(),y(void 0),L(void 0),j({}))},N=g=>{K(C=>Math.max(250,Math.min(800,C+g)))},I=g=>{$(C=>Math.max(300,Math.min(1e3,C+g)))},P=async g=>{var C;u({role:"user",content:g}),i(!0),c(null);try{const W=[...n.filter(R=>R.role!=="system").map(R=>({role:R.role,content:R.content})),{role:"user",content:g}],B=$e();u({role:"assistant",content:""});let q="";for await(const R of et(B,W))q+=R,l(q);const U=await rt(q);U.shader&&(o(U.shader,(C=n[n.length-1])==null?void 0:C.id),!U.isValid&&U.error&&u({role:"system",content:`Validation Error: ${U.error}`,metadata:{validationError:U.error}}))}catch(W){const B=W instanceof Error?W.message:"Unknown error";c(B),u({role:"system",content:`Error: ${B}`})}finally{i(!1)}};if(!ne().supported){const g=window.location.protocol==="http:"&&!window.location.hostname.match(/^(localhost|127\.0\.0\.1)$/);return e.jsx("div",{className:"flex items-center justify-center h-screen bg-gray-900",children:e.jsxs("div",{className:"text-center p-8 bg-red-900/20 border border-red-500 rounded-lg max-w-md",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-400 mb-4",children:"WebGPU Not Supported"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Your browser doesn't support WebGPU."}),g?e.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-600 rounded p-4 mb-4",children:[e.jsx("p",{className:"text-yellow-200 text-sm mb-2",children:e.jsx("strong",{children:" Insecure Context Detected"})}),e.jsx("p",{className:"text-yellow-100 text-sm",children:"WebGPU requires HTTPS or localhost. You're accessing this page via HTTP."})]}):null,e.jsxs("div",{className:"text-left text-sm text-gray-400 space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"Requirements:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Chrome 113+ or Edge 113+"}),e.jsx("li",{children:"HTTPS connection or localhost"})]})]})]})})}return e.jsxs("div",{className:"h-screen flex flex-col bg-gray-900 text-white",children:[e.jsx("header",{className:"bg-gray-800 border-b border-gray-700 p-2 md:p-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("h1",{className:"text-lg md:text-2xl font-bold truncate",children:"WebGPU Shader Generator"}),e.jsxs("p",{className:"text-xs md:text-sm text-gray-400 truncate",children:[e.jsx("span",{className:"hidden sm:inline",children:"AI-powered iterative WGSL shader creation"}),e.jsx("span",{className:"sm:hidden",children:"AI shader generation"}),A&&e.jsxs("span",{className:"ml-2 text-blue-400",children:[" ",A]})]})]}),e.jsxs("div",{className:"flex gap-1 md:gap-2 ml-2",children:[e.jsx("button",{onClick:f,className:"px-2 md:px-3 py-2 bg-gray-700 hover:bg-gray-600 rounded text-sm font-medium transition-colors",title:"New Project",children:e.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("button",{onClick:()=>v(!0),className:"px-2 md:px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded text-sm font-medium transition-colors flex items-center gap-1 md:gap-2",children:[e.jsx("svg",{className:"w-4 h-4 md:w-5 md:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"})}),e.jsx("span",{className:"hidden sm:inline",children:"Projects"})]})]})]})}),e.jsxs("div",{className:"flex-1 flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"md:hidden flex flex-col flex-1 overflow-hidden",children:[e.jsx(le,{activeTab:S,onTabChange:O}),S==="chat"&&e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx(X,{onSendMessage:P,onOpenApiKeyDialog:()=>D(!0)})}),S==="editor"&&e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx(J,{shader:s,onChange:o,readOnly:r})}),S==="preview"&&e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Z,{shader:s,onValuesChange:j}),e.jsx("div",{className:"flex-1 p-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-black rounded-lg overflow-hidden",children:e.jsx(Q,{shader:s,vertexShader:t,customUniforms:p})})})]})]}),e.jsxs("div",{className:"hidden md:flex lg:hidden flex-1 flex-col overflow-hidden",children:[e.jsx(le,{activeTab:S,onTabChange:O}),S==="chat"&&e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx(X,{onSendMessage:P,onOpenApiKeyDialog:()=>D(!0)})}),S==="editor"&&e.jsx("div",{className:"flex-1 flex flex-col overflow-hidden",children:e.jsx(J,{shader:s,onChange:o,readOnly:r})}),S==="preview"&&e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[e.jsx(Z,{shader:s,onValuesChange:j}),e.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-black rounded-lg overflow-hidden",children:e.jsx(Q,{shader:s,vertexShader:t,customUniforms:p})})})]})]}),e.jsx("div",{style:{width:`${T}px`},className:"hidden lg:flex flex-shrink-0 flex-col",children:e.jsx(X,{onSendMessage:P,onOpenApiKeyDialog:()=>D(!0)})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(ie,{onResize:N})}),e.jsx("div",{style:{width:`${V}px`},className:"hidden lg:flex flex-shrink-0 flex-col",children:e.jsx(J,{shader:s,onChange:o,readOnly:r})}),e.jsx("div",{className:"hidden lg:block",children:e.jsx(ie,{onResize:I})}),e.jsxs("div",{className:"hidden lg:flex flex-1 flex-col overflow-hidden",children:[e.jsx(Z,{shader:s,onValuesChange:j}),e.jsx("div",{className:"flex-1 p-4 overflow-hidden",children:e.jsx("div",{className:"h-full bg-black rounded-lg overflow-hidden",children:e.jsx(Q,{shader:s,vertexShader:t,customUniforms:p})})})]})]}),e.jsx("footer",{className:"bg-gray-800 border-t border-gray-700 p-2 text-center text-xs text-gray-400",children:"Powered by Claude & WebGPU | Chat to iteratively refine your shader"}),e.jsx(_e,{isOpen:w,onClose:()=>v(!1),currentShader:s,currentVertexShader:t,currentMessages:n,currentUniforms:p,onLoadProject:G,currentProjectId:d}),e.jsx(tt,{isOpen:E,onClose:()=>D(!1),allowCancel:te()!==null})]})}ee.createRoot(document.getElementById("root")).render(e.jsx(we.StrictMode,{children:e.jsx(st,{})}));
